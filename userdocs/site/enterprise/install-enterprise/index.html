<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="The Flux expansion pack from the founders of Flux" name=description><meta content="Weave GitOps authors" name=author><link href=https://docs.gitops.weave.works/enterprise/install-enterprise/ rel=canonical><link href=../ rel=prev><link href=../install-enterprise-cli/ rel=next><link href=../../img/favicon_150px.png rel=icon><meta content="mkdocs-1.4.2, mkdocs-material-9.0.6" name=generator><title>Install Weave GitOps Enterprise - Weave GitOps</title><link href=../../assets/stylesheets/main.558e4712.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.2505c338.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Segoe+UI:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Segoe UI";--md-code-font:"Roboto Mono"}</style><link href=../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta content=website property=og:type><meta content="Install Weave GitOps Enterprise - Weave GitOps" property=og:title><meta content="The Flux expansion pack from the founders of Flux" property=og:description><meta content=https://docs.gitops.weave.works/assets/images/social/enterprise/install-enterprise.png property=og:image><meta content=image/png property=og:image:type><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content=https://docs.gitops.weave.works/enterprise/install-enterprise/ property=og:url><meta content=summary_large_image name=twitter:card><meta content="Install Weave GitOps Enterprise - Weave GitOps" name=twitter:title><meta content="The Flux expansion pack from the founders of Flux" name=twitter:description><meta content=https://docs.gitops.weave.works/assets/images/social/enterprise/install-enterprise.png name=twitter:image><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=light-blue data-md-color-primary=deep-orange data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#install-weave-gitops-enterprise-enterprise> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Weave GitOps" class="md-header__button md-logo" data-md-component=logo href=../.. title="Weave GitOps"> <img alt=logo src=../../img/logo.ico> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Weave GitOps </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Install Weave GitOps Enterprise </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=light-blue data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary=deep-orange data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=light-blue data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary=deep-orange data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Share> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/weaveworks/weave-gitops title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> weaveworks/weave-gitops </div> </a> </div> </nav> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../..> Home </a> </li> <li class=md-tabs__item> <a href=../../intro-weave-gitops/ class="md-tabs__link md-tabs__link--active"> Docs </a> </li> <li class=md-tabs__item> <a href=../../references/helm-reference/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../security/ class=md-tabs__link> Security </a> </li> <li class=md-tabs__item> <a href=../../feedback-and-telemetry/ class=md-tabs__link> Feedback &amp; Telemetry </a> </li> <li class=md-tabs__item> <a href=../../help-and-support/ class=md-tabs__link> Support </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Weave GitOps" class="md-nav__button md-logo" data-md-component=logo href=../.. title="Weave GitOps"> <img alt=logo src=../../img/logo.ico> </a> Weave GitOps </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/weaveworks/weave-gitops title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> weaveworks/weave-gitops </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../..> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label aria-expanded=true class=md-nav__link for=__nav_2 tabindex=0> Docs <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Docs class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 id=__nav_2_1 type=checkbox> <label aria-expanded=true class=md-nav__link for=__nav_2_1 tabindex=0> Introducing Weave GitOps <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Introducing Weave GitOps" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Introducing Weave GitOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../intro-weave-gitops/ class=md-nav__link> Introducing Weave GitOps </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_2 id=__nav_2_1_2 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_1_2 tabindex=0> Weave GitOps OSS <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Weave GitOps OSS" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_1_2> <span class="md-nav__icon md-icon"></span> Weave GitOps OSS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../open-source/install-oss/ class=md-nav__link> Step 1 - Install Weave GitOps Open Source </a> </li> <li class=md-nav__item> <a href=../../open-source/ui-oss/ class=md-nav__link> Step 2 - Explore the Open Source UI </a> </li> <li class=md-nav__item> <a href=../../open-source/deploy-oss/ class=md-nav__link> Step 3 - Deploy an Application </a> </li> <li class=md-nav__item> <a href=../../open-source/aws-marketplace/ class=md-nav__link> AWS Marketplace </a> </li> <li class=md-nav__item> <a href=../../open-source/run-ui-subpath/ class=md-nav__link> Optional: Running the UI on a Subpath </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_3 id=__nav_2_1_3 type=checkbox> <label aria-expanded=true class=md-nav__link for=__nav_2_1_3 tabindex=0> Weave GitOps Enterprise <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Weave GitOps Enterprise" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_1_3> <span class="md-nav__icon md-icon"></span> Weave GitOps Enterprise </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Introduction to Weave GitOps Enterprise </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> Install Weave GitOps Enterprise <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Install Weave GitOps Enterprise </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#prerequisites> Prerequisites </a> <nav aria-label=Prerequisites class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#install-the-weave-gitops-enterprise-cli-tool> Install the Weave GitOps Enterprise CLI Tool </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#install-flux-onto-your-cluster-with-the-flux-bootstrap-command> Install Flux Onto Your Cluster with the flux bootstrap Command </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apply-your-entitlements-secret-to-your-cluster> Apply Your Entitlements Secret to Your Cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#set-up-authentication-and-rbac> Set up Authentication and RBAC </a> <nav aria-label="Set up Authentication and RBAC" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#securing-access-to-the-dashboard> Securing Access to the Dashboard </a> <nav aria-label="Securing Access to the Dashboard" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#customization> Customization </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#scopes> Scopes </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#claims> Claims </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-oidc-with-dex-and-github> Configuring OIDC with Dex and GitHub </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#deploy-dex> Deploy Dex </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#set-up-a-static-user> Set up a Static User </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#oidc-login> OIDC Login </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-the-emergency-user> Configuring the Emergency User </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#updating-the-emergency-user> Updating the Emergency User </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#user-permissions> User Permissions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#gitops-dashboard-service-account-permissions> GitOps Dashboard Service Account Permissions </a> <nav aria-label="GitOps Dashboard Service Account Permissions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#impersonation> Impersonation </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#get-namespaces> Get Namespaces </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#reading-the-cluster-user-auth-and-oidc-auth-secrets> Reading the cluster-user-auth and oidc-auth Secrets </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#user-permissions_1> User Permissions </a> <nav aria-label="User Permissions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#flux-resources> Flux Resources </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#resources-managed-via-flux> Resources Managed via Flux </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#feedback-from-flux> Feedback from Flux </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#login-ui> Login UI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#recommended-rbac-configuration> Recommended RBAC Configuration </a> <nav aria-label="Recommended RBAC Configuration" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#example-setup> Example Setup </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#code> Code </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#configure-access-for-writing-to-git-from-the-weave-gitops-enterprise-ui> Configure Access for Writing to Git from the Weave GitOps Enterprise UI </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#tls-configuration> TLS Configuration </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configure-helm-chart-and-commit> Configure Helm Chart and Commit </a> <nav aria-label="Configure Helm Chart and Commit" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#valuesconfigcapirepositoryurl> values.config.capi.repositoryURL </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#valuesconfigcapirepositorypath> values.config.capi.repositoryPath </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#valuesconfigcapirepositoryclusterspath> values.config.capi.repositoryClustersPath </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#configure-your-password> Configure Your Password </a> <nav aria-label="Configure Your Password" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#optional-install-policy-agent> (Optional) Install Policy Agent </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#next-steps> Next Steps </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../install-enterprise-cli/ class=md-nav__link> Install Weave GitOps Enterprise via CLI </a> </li> <li class=md-nav__item> <a href=../install-enterprise-airgap/ class=md-nav__link> Install Enterprise in Air-gapped Environments </a> </li> <li class=md-nav__item> <a href=../releases-enterprise/ class=md-nav__link> Enterprise Releases </a> </li> <li class=md-nav__item> <a href=../install-enterprise-azure/ class=md-nav__link> Azure and Weave GitOps Enterprise Installation </a> </li> <li class=md-nav__item> <a href=../join-cluster-azure-flux/ class=md-nav__link> Join a Cluster with Azure Flux </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../backstage/ class=md-nav__link> Backstage </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 id=__nav_2_3 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_3 tabindex=0> Cluster Management <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Cluster Management" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Cluster Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cluster-management/ class=md-nav__link> Cluster Management - Introduction </a> </li> <li class=md-nav__item> <a href=../../cluster-management/managing-clusters-without-capi/ class=md-nav__link> Managing Clusters Without Cluster API </a> </li> <li class=md-nav__item> <a href=../../cluster-management/deploying-capa-eks/ class=md-nav__link> Deploying CAPA with EKS </a> </li> <li class=md-nav__item> <a href=../../cluster-management/profiles/ class=md-nav__link> Profiles </a> </li> <li class=md-nav__item> <a href=../../cluster-management/cluster-management-troubleshooting/ class=md-nav__link> Cluster Management Troubleshooting </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3_6 id=__nav_2_3_6 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_3_6 tabindex=0> Advanced Cluster management <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Advanced Cluster management" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_3_6> <span class="md-nav__icon md-icon"></span> Advanced Cluster management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cluster-management/advanced-cluster-management-topics/how-to-inject-credentials-into-template/ class=md-nav__link> How to Inject Credentials Into Your Template </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 id=__nav_2_4 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_4 tabindex=0> Explorer <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Explorer class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Explorer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../explorer/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../explorer/getting-started/ class=md-nav__link> Getting started </a> </li> <li class=md-nav__item> <a href=../../explorer/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../explorer/querying/ class=md-nav__link> Querying </a> </li> <li class=md-nav__item> <a href=../../explorer/operations/ class=md-nav__link> Operations </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5 id=__nav_2_5 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_5 tabindex=0> GitOpsSets <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=GitOpsSets class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> GitOpsSets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gitopssets/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../gitopssets/gitopssets-installation/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../gitopssets/templating-from-generators/ class=md-nav__link> Templating from Generators </a> </li> <li class=md-nav__item> <a href=../../gitopssets/gitopssets-api-reference/ class=md-nav__link> API reference </a> </li> <li class=md-nav__item> <a href=../../gitopssets/gitopssets-releases/ class=md-nav__link> Releases </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6 id=__nav_2_6 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_6 tabindex=0> Guides <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Guides class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/displaying-custom-metadata/ class=md-nav__link> Displaying Custom Metadata </a> </li> <li class=md-nav__item> <a href=../../guides/fluxga-upgrade/ class=md-nav__link> Upgrade to Flux GA </a> </li> <li class=md-nav__item> <a href=../../guides/anonymous-access/ class=md-nav__link> Anonymous Access </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../monitoring/ class=md-nav__link> Operations </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_8 id=__nav_2_8 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_8 tabindex=0> Pipelines <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Pipelines class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../pipelines/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../pipelines/pipelines-getting-started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../pipelines/authorization/ class=md-nav__link> Authorization </a> </li> <li class=md-nav__item> <a href=../../pipelines/promoting-applications/ class=md-nav__link> Promoting applications </a> </li> <li class=md-nav__item> <a href=../../pipelines/pipelines-templates/ class=md-nav__link> Using GitOpsTemplates for Pipelines </a> </li> <li class=md-nav__item> <a href=../../pipelines/pipelines-with-jenkins/ class=md-nav__link> Pipelines With Jenkins Webhook </a> </li> <li class=md-nav__item> <a href=../../pipelines/pipelines-with-tekton/ class=md-nav__link> Pipelines With Tekton </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_8_8 id=__nav_2_8_8 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_8_8 tabindex=0> Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Reference class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_8_8> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../pipelines/spec/v1alpha1/pipeline/ class=md-nav__link> v1alpha1 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_9 id=__nav_2_9 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_9 tabindex=0> Policy <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Policy class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> Policy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../policy/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../policy/getting-started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../policy/authorization/ class=md-nav__link> Authorization </a> </li> <li class=md-nav__item> <a href=../../policy/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../policy/weave-policy-profile/ class=md-nav__link> Policy Profile </a> </li> <li class=md-nav__item> <a href=../../policy/policy-set/ class=md-nav__link> PolicySet </a> </li> <li class=md-nav__item> <a href=../../policy/policy-configuration/ class=md-nav__link> PolicyConfig </a> </li> <li class=md-nav__item> <a href=../../policy/releases/ class=md-nav__link> Profile Releases </a> </li> <li class=md-nav__item> <a href=../../policy/commit-time-checks/ class=md-nav__link> Commit/Build Time Checks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_10 id=__nav_2_10 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_10 tabindex=0> Progressive Delivery <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Progressive Delivery" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_10> <span class="md-nav__icon md-icon"></span> Progressive Delivery </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../progressive-delivery/progressive-delivery-flagger-install/ class=md-nav__link> Progressive Delivery Using Flagger </a> </li> <li class=md-nav__item> <a href=../../progressive-delivery/flagger-manual-gating/ class=md-nav__link> Manual Approval for Progressive Delivery Deployments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_11 id=__nav_2_11 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_11 tabindex=0> Secrets <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Secrets class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_11> <span class="md-nav__icon md-icon"></span> Secrets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../secrets/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../secrets/getting-started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../secrets/bootstrapping-secrets/ class=md-nav__link> Bootstrapping Secrets </a> </li> <li class=md-nav__item> <a href=../../secrets/setup-eso/ class=md-nav__link> Setup ESO </a> </li> <li class=md-nav__item> <a href=../../secrets/setup-sops/ class=md-nav__link> Setup SOPS </a> </li> <li class=md-nav__item> <a href=../../secrets/manage-secrets-ui/ class=md-nav__link> Manage Secrets UI </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_11_7 id=__nav_2_11_7 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_11_7 tabindex=0> Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Reference class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_11_7> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../secrets/spec/v1alpha1/secretSync/ class=md-nav__link> v1alpha1 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_12 id=__nav_2_12 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_12 tabindex=0> Templates <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Templates class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_12> <span class="md-nav__icon md-icon"></span> Templates </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gitops-templates/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_12_2 id=__nav_2_12_2 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_12_2 tabindex=0> Creating Templates <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Creating Templates" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_12_2> <span class="md-nav__icon md-icon"></span> Creating Templates </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gitops-templates/creating-templates/ class=md-nav__link> Creating Templates </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/resource-templates/ class=md-nav__link> Resource Templates </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/repo-rendered-paths/ class=md-nav__link> Rendered Template Paths </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/profiles/ class=md-nav__link> Profiles </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/annotations/ class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/params/ class=md-nav__link> Parameters </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/supported-langs/ class=md-nav__link> Supported Templating Languages </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/create-cluster-example/ class=md-nav__link> Example: Template to Create a CAPI Cluster </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/quickstart-templates/ class=md-nav__link> Quickstart </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../gitops-templates/cli/ class=md-nav__link> CLI </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/versions/ class=md-nav__link> Version Information </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_13 id=__nav_2_13 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_13 tabindex=0> Terraform <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Terraform class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_13> <span class="md-nav__icon md-icon"></span> Terraform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../terraform/ class=md-nav__link> Introduction to Terraform Controller </a> </li> <li class=md-nav__item> <a href=../../terraform/get-started-terraform/ class=md-nav__link> Get Started </a> </li> <li class=md-nav__item> <a href=../../terraform/using-terraform-templates/ class=md-nav__link> Using Terraform Templates </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_14 id=__nav_2_14 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_14 tabindex=0> Workspaces <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Workspaces class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_14> <span class="md-nav__icon md-icon"></span> Workspaces </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../workspaces/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../workspaces/multi-tenancy/ class=md-nav__link> Multi Tenancy </a> </li> <li class=md-nav__item> <a href=../../workspaces/view-workspaces/ class=md-nav__link> Workspaces View </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 id=__nav_3 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_3 tabindex=0> Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Reference class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../references/helm-reference/ class=md-nav__link> OSS Helm Reference </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 id=__nav_3_2 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_3_2 tabindex=0> CLI Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="CLI Reference" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> CLI Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../references/cli-reference/gitops/ class=md-nav__link> Gitops </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_check/ class=md-nav__link> Gitops check </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion/ class=md-nav__link> Gitops completion </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion_bash/ class=md-nav__link> Gitops completion bash </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion_fish/ class=md-nav__link> Gitops completion fish </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion_powershell/ class=md-nav__link> Gitops completion powershell </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion_zsh/ class=md-nav__link> Gitops completion zsh </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_create/ class=md-nav__link> Gitops create </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_create_dashboard/ class=md-nav__link> Gitops create dashboard </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_create_terraform/ class=md-nav__link> Gitops create terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_delete/ class=md-nav__link> Gitops delete </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_delete_terraform/ class=md-nav__link> Gitops delete terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_get/ class=md-nav__link> Gitops get </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_get_bcrypt-hash/ class=md-nav__link> Gitops get bcrypt hash </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_get_config/ class=md-nav__link> Gitops get config </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_logs/ class=md-nav__link> Gitops logs </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_logs_terraform/ class=md-nav__link> Gitops logs terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_replan/ class=md-nav__link> Gitops replan </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_replan_terraform/ class=md-nav__link> Gitops replan terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_resume/ class=md-nav__link> Gitops resume </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_resume_terraform/ class=md-nav__link> Gitops resume terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_set/ class=md-nav__link> Gitops set </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_set_config/ class=md-nav__link> Gitops set config </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_suspend/ class=md-nav__link> Gitops suspend </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_suspend_terraform/ class=md-nav__link> Gitops suspend terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_version/ class=md-nav__link> Gitops version </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../feedback-and-telemetry/ class=md-nav__link> Feedback &amp; Telemetry </a> </li> <li class=md-nav__item> <a href=../../help-and-support/ class=md-nav__link> Support </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#prerequisites> Prerequisites </a> <nav aria-label=Prerequisites class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#install-the-weave-gitops-enterprise-cli-tool> Install the Weave GitOps Enterprise CLI Tool </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#install-flux-onto-your-cluster-with-the-flux-bootstrap-command> Install Flux Onto Your Cluster with the flux bootstrap Command </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apply-your-entitlements-secret-to-your-cluster> Apply Your Entitlements Secret to Your Cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#set-up-authentication-and-rbac> Set up Authentication and RBAC </a> <nav aria-label="Set up Authentication and RBAC" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#securing-access-to-the-dashboard> Securing Access to the Dashboard </a> <nav aria-label="Securing Access to the Dashboard" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#customization> Customization </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#scopes> Scopes </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#claims> Claims </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-oidc-with-dex-and-github> Configuring OIDC with Dex and GitHub </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#deploy-dex> Deploy Dex </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#set-up-a-static-user> Set up a Static User </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#oidc-login> OIDC Login </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuring-the-emergency-user> Configuring the Emergency User </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#updating-the-emergency-user> Updating the Emergency User </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#user-permissions> User Permissions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#gitops-dashboard-service-account-permissions> GitOps Dashboard Service Account Permissions </a> <nav aria-label="GitOps Dashboard Service Account Permissions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#impersonation> Impersonation </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#get-namespaces> Get Namespaces </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#reading-the-cluster-user-auth-and-oidc-auth-secrets> Reading the cluster-user-auth and oidc-auth Secrets </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#user-permissions_1> User Permissions </a> <nav aria-label="User Permissions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#flux-resources> Flux Resources </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#resources-managed-via-flux> Resources Managed via Flux </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#feedback-from-flux> Feedback from Flux </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#login-ui> Login UI </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#recommended-rbac-configuration> Recommended RBAC Configuration </a> <nav aria-label="Recommended RBAC Configuration" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#example-setup> Example Setup </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#code> Code </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#configure-access-for-writing-to-git-from-the-weave-gitops-enterprise-ui> Configure Access for Writing to Git from the Weave GitOps Enterprise UI </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#tls-configuration> TLS Configuration </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configure-helm-chart-and-commit> Configure Helm Chart and Commit </a> <nav aria-label="Configure Helm Chart and Commit" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#valuesconfigcapirepositoryurl> values.config.capi.repositoryURL </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#valuesconfigcapirepositorypath> values.config.capi.repositoryPath </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#valuesconfigcapirepositoryclusterspath> values.config.capi.repositoryClustersPath </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#configure-your-password> Configure Your Password </a> <nav aria-label="Configure Your Password" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#optional-install-policy-agent> (Optional) Install Policy Agent </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#next-steps> Next Steps </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=install-weave-gitops-enterprise-enterprise>Install Weave GitOps Enterprise <sub>ENTERPRISE</sub><a class=headerlink href=#install-weave-gitops-enterprise-enterprise title="Permanent link">¶</a></h1> <div class="admonition info"> <p class=admonition-title>Info</p> <p>To purchase an entitlement to Weave GitOps Enterprise, please contact <a href=mailto:sales@weave.works>sales@weave.works</a>. There is no need to install the open source version of Weave GitOps before installing Weave GitOps Enterprise.</p> </div> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">¶</a></h2> <p>To get up and running with Weave GitOps Enterprise: - create a Kubernetes cluster - add your cluster to kubeconfig—which you'll get from Kubernetes—so that the kubeconfig correctly points to the management cluster - create a Git repository; in the instructions below, we refer to a <code>fleet-infra</code> repository - configure your Git client properly (if using GitHub, for example, then review their docs on <a href=https://docs.github.com/en/get-started/getting-started-with-git/setting-your-username-in-git#setting-your-git-username-for-every-repository-on-your-computer>setting your username</a> and <a href=https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/setting-your-commit-email-address#setting-your-email-address-for-every-repository-on-your-computer>your email address</a>) - obtain a valid entitlement secret from Weaveworks and apply it to your cluster - install a compatible version of Flux onto your cluster; see below for how-to guidance</p> <h3 id=install-the-weave-gitops-enterprise-cli-tool>Install the Weave GitOps Enterprise CLI Tool<a class=headerlink href=#install-the-weave-gitops-enterprise-cli-tool title="Permanent link">¶</a></h3> <p>To do this, you can use either brew or curl.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Homebrew</label><label for=__tabbed_1_2>Curl</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>brew<span class=w> </span>install<span class=w> </span>weaveworks/tap/gitops-ee
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>VERSION</span><span class=o>=</span>&lt;VERSION&gt;
curl<span class=w> </span>--silent<span class=w> </span>--location<span class=w> </span><span class=s2>"https://artifacts.wge.dev.weave.works/releases/bin/</span><span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span><span class=s2>/gitops-</span><span class=k>$(</span>uname<span class=k>)</span><span class=s2>-</span><span class=k>$(</span>uname<span class=w> </span>-m<span class=k>)</span><span class=s2>.tar.gz"</span><span class=w> </span><span class=p>|</span><span class=w> </span>tar<span class=w> </span>xz<span class=w> </span>-C<span class=w> </span>/tmp
sudo<span class=w> </span>mv<span class=w> </span>/tmp/gitops<span class=w> </span>/usr/local/bin
gitops<span class=w> </span>version
</code></pre></div> </div> </div> </div> <h3 id=install-flux-onto-your-cluster-with-the-flux-bootstrap-command>Install Flux Onto Your Cluster with the <code>flux bootstrap</code> Command<a class=headerlink href=#install-flux-onto-your-cluster-with-the-flux-bootstrap-command title="Permanent link">¶</a></h3> <p>The <code>flux bootstrap</code> command enables you to deploy Flux on a cluster the GitOps way. Go <a href=https://fluxcd.io/docs/cmd/ >here</a> for more information about the command.</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>GitHub</label><label for=__tabbed_2_2>GitLab</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>flux<span class=w> </span>bootstrap<span class=w> </span>github<span class=w> </span><span class=se>\</span>
--owner<span class=o>=</span>&lt;github<span class=w> </span>username&gt;<span class=w> </span><span class=se>\</span>
--repository<span class=o>=</span>fleet-infra<span class=w> </span><span class=se>\</span>
--branch<span class=o>=</span>main<span class=w> </span><span class=se>\</span>
--path<span class=o>=</span>./clusters/management<span class=w> </span><span class=se>\</span>
--personal<span class=w> </span><span class=se>\</span>
--components-extra<span class=w> </span>image-reflector-controller,image-automation-controller
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>flux<span class=w> </span>bootstrap<span class=w> </span>gitlab<span class=w> </span><span class=se>\</span>
--owner<span class=o>=</span>&lt;gitlab<span class=w> </span>username&gt;<span class=w> </span><span class=se>\</span>
--repository<span class=o>=</span>fleet-infra<span class=w> </span><span class=se>\</span>
--branch<span class=o>=</span>main<span class=w> </span><span class=se>\</span>
--path<span class=o>=</span>./clusters/management<span class=w> </span><span class=se>\</span>
--personal<span class=w> </span><span class=se>\</span>
--components-extra<span class=w> </span>image-reflector-controller,image-automation-controller
</code></pre></div> </div> </div> </div> <p>Your private Git repo should have a clusters/management folder that includes the manifests Flux needs to operate, and that also generates a key value pair for Flux to access the repo.</p> <ul> <li><strong>owner</strong>: The username (or organization) of the Git repository</li> <li><strong>repository</strong>: Git repository name</li> <li><strong>branch</strong>: Git branch (default "main")</li> <li><strong>path</strong>: Path relative to the repository root; when specified, the cluster sync will be scoped to this path</li> <li><strong>personal</strong>: If set, the owner is assumed to be a repo user</li> <li><strong>components-extra</strong>: Additional controllers to install</li> </ul> <p>At this point your Flux management cluster should be running. Take a look at the repository you created earlier.</p> <h3 id=apply-your-entitlements-secret-to-your-cluster>Apply Your Entitlements Secret to Your Cluster<a class=headerlink href=#apply-your-entitlements-secret-to-your-cluster title="Permanent link">¶</a></h3> <p>As noted above, you receive your entitlements secret by contacting sales@weave.works. Use this command to apply it to the cluster:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>entitlements.yaml
</code></pre></div> <h2 id=set-up-authentication-and-rbac>Set up Authentication and RBAC<a class=headerlink href=#set-up-authentication-and-rbac title="Permanent link">¶</a></h2> <h3 id=securing-access-to-the-dashboard>Securing Access to the Dashboard<a class=headerlink href=#securing-access-to-the-dashboard title="Permanent link">¶</a></h3> <p>There are two supported methods for logging in to the dashboard, that work with standard Kubernetes RBAC: - Login via an OIDC provider: recommended, as this will allow you to control permissions for existing users and groups that have already been configured to use OIDC. OIDC decouples the need to manage user lists from the application, allowing it to be managed via a central system designed for that purpose (i.e. the OIDC provider). OIDC also enables the creation of groups—either via your provider's own systems or by using a connector like <a href=#configuring-oidc-with-dex-and-github>Dex</a>. - Login via a cluster user account: which is insecure, and which we only recommend for local and development environments or if you need to activate emergency access to a damaged cluster. However, it is an option if an OIDC provider is not available.</p> <p>You may decide to give your engineering teams access to the WGE dashboard so they can view and manage their workloads. In this case, you will want to secure dashboard access and restrict who can interact with it. Weave GitOps Enterprise integrates with your OIDC provider and uses standard Kubernetes RBAC to give you fine-grained control of the dashboard users' permissions.</p> <p>OIDC extends the OAuth2 authorization protocol by including an additional field (ID Token) that contains information (claims) about a user's identity. After a user successfully authenticates with the OIDC provider, Weave GitOps Enterprise uses this information to impersonate the user in any calls to the Kubernetes API. This allows cluster administrators to use RBAC rules to control access to the cluster and the dashboard.</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:3><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><input id=__tabbed_3_3 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Login via an OIDC provider</label><label for=__tabbed_3_2>Configuring OIDC with Dex and GitHub</label><label for=__tabbed_3_3>Login via a cluster user account</label></div> <div class=tabbed-content> <div class=tabbed-block> <p>To login via your OIDC provider, create a Kubernetes secret to store the OIDC configuration. This configuration consists of the following parameters:</p> <table> <thead> <tr> <th>Parameter</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>issuerURL</code></td> <td>The URL of the issuer; typically, the discovery URL without a path</td> <td></td> </tr> <tr> <td><code>clientID</code></td> <td>The client ID set up for Weave GitOps in the issuer</td> <td></td> </tr> <tr> <td><code>clientSecret</code></td> <td>The client secret set up for Weave GitOps in the issuer</td> <td></td> </tr> <tr> <td><code>redirectURL</code></td> <td>The redirect URL set up for Weave GitOps in the issuer—typically the dashboard URL, followed by <code>/oauth2/callback</code></td> <td></td> </tr> <tr> <td><code>tokenDuration</code></td> <td>The time duration that the ID Token will remain valid after successful authentication</td> <td>"1h0m0s"</td> </tr> <tr> <td><code>tokenDuration</code></td> <td>The time duration that the ID Token will remain valid after successful authentication</td> <td>"1h0m0s"</td> </tr> <tr> <td><code>oidcUsernamePrefix</code></td> <td>The prefix added to users when impersonating API calls to the Kubernetes API, equivalent to --oidc-username-prefix</td> <td></td> </tr> <tr> <td><code>oidcGroupsPrefix</code></td> <td>The prefix added to groups when impersonating API calls to the Kubernetes API, equivalent to --oidc-groups-prefix</td> <td></td> </tr> </tbody> </table> <p>Ensure that your OIDC provider has been set up with a client ID/secret and the dashboard's redirect URL.</p> <p>Create a secret named <code>oidc-auth</code> in the <code>flux-system</code> namespace with these parameters set:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>oidc-auth<span class=w> </span><span class=se>\</span>
--namespace<span class=w> </span>flux-system<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>issuerURL</span><span class=o>=</span>&lt;oidc-issuer-url&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>clientID</span><span class=o>=</span>&lt;client-id&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>clientSecret</span><span class=o>=</span>&lt;client-secret&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>redirectURL</span><span class=o>=</span>&lt;redirect-url&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>tokenDuration</span><span class=o>=</span>&lt;token-duration&gt;
</code></pre></div> <p>Once the HTTP server starts, unauthenticated users will have to click 'Login With OIDC Provider' to log in or use the cluster account (if configured). Upon successful authentication, the users' identities will be impersonated in any calls made to the Kubernetes API, as part of any action they take in the dashboard. By default the Helm chart will configure RBAC correctly, but we recommend reading the <a href=#gitops-dashboard-service-account-permissions>service account</a> and <a href=#user-permissions>user permissions</a> pages to understand which actions are needed for Weave GitOps to function correctly.</p> <h4 id=customization>Customization<a class=headerlink href=#customization title="Permanent link">¶</a></h4> <p>For some OIDC configurations, you may need to customise the requested <a href=https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims>scopes</a> or <a href=https://openid.net/specs/openid-connect-core-1_0.html#Claims>claims</a>.</p> <p>The <code>oidcUsernamePrefix</code> and <code>oidcGroupsPrefix</code> work in the same way as the Kubernetes <a href=https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/ >kube-apiserver</a> command-line options, if you need them for Kubernetes, you will likely need them here.</p> <h4 id=scopes>Scopes<a class=headerlink href=#scopes title="Permanent link">¶</a></h4> <p>By default, the following scopes are requested: "openid","offline_access","email","groups".</p> <p>The "openid" scope is <strong>mandatory</strong> for OpenID auth and will be added if not provided. The "email" and "groups" scopes are commonly used as unique identifiers in organisations.</p> <p>"offline_access" allows us to refresh OIDC tokens to keep login sessions alive for as long as a refresh token is valid. You can, however, change the defaults. <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>oidc-auth<span class=w> </span><span class=se>\</span>
--namespace<span class=w> </span>flux-system<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>issuerURL</span><span class=o>=</span>&lt;oidc-issuer-url&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>clientID</span><span class=o>=</span>&lt;client-id&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>clientSecret</span><span class=o>=</span>&lt;client-secret&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>redirectURL</span><span class=o>=</span>&lt;redirect-url&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>tokenDuration</span><span class=o>=</span>&lt;token-duration&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>customScopes</span><span class=o>=</span>custom,scopes
</code></pre></div> The format for the <code>customScopes</code> key is a comma-separated list of scopes to request. In this case, "custom", "scopes", and "openid" would be requested.</p> <h4 id=claims>Claims<a class=headerlink href=#claims title="Permanent link">¶</a></h4> <p>By default, the following claims are parsed from the OpenID <a href=https://openid.net/specs/openid-connect-core-1_0.html#CodeIDToken>ID Token</a> "email" and "groups". These are presented as the <code>user</code> and <code>groups</code> when WGE communicates with your Kubernetes API server.</p> <p>This is equivalent to <a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/#configuring-the-api-server>configuring</a> your <code>kube-apiserver</code> with <code>--oidc-username-claim=email --oidc-groups-claim=groups</code>.</p> <p>Again, you can configure these from the <code>oidc-auth</code> <code>Secret</code>.</p> <p><div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>oidc-auth<span class=w> </span><span class=se>\</span>
--namespace<span class=w> </span>flux-system<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>issuerURL</span><span class=o>=</span>&lt;oidc-issuer-url&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>clientID</span><span class=o>=</span>&lt;client-id&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>clientSecret</span><span class=o>=</span>&lt;client-secret&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>redirectURL</span><span class=o>=</span>&lt;redirect-url&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>tokenDuration</span><span class=o>=</span>&lt;token-duration&gt;<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>claimUsername</span><span class=o>=</span>sub<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>claimGroups</span><span class=o>=</span>groups
</code></pre></div> There are two separate configuration keys. You can override them separately. They should match your <code>kube-apiserver</code> configuration.</p> </div> <div class=tabbed-block> <h4 id=configuring-oidc-with-dex-and-github>Configuring OIDC with Dex and GitHub<a class=headerlink href=#configuring-oidc-with-dex-and-github title="Permanent link">¶</a></h4> <p>This example uses <a href=https://dexidp.io/ >Dex</a> and its <a href=https://dexidp.io/docs/connectors/github/ >GitHub connector</a> to show you how to log in to the Weave GitOps dashboard by authenticating with your GitHub account. It assumes you have already installed Weave GitOps on a Kubernetes cluster, per the instructions above, and have also <a href=#tls-configuration>enabled TLS</a>.</p> <p>Dex is an identity service that uses <a href=https://openid.net/connect/ >OpenID Connect</a> to drive authentication for other apps. There are other solutions for identity and access management, such as <a href=https://www.keycloak.org/ >Keycloak</a>.</p> <p>Create a namespace where you will install Dex:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex</span>
</code></pre></div> <p>Get a GitHub ClientID and Client secret by creating a <a href=https://docs.github.com/en/developers/apps/building-oauth-apps/creating-an-oauth-app>new OAuth application</a>.</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=../../img/guides/setting-up-dex/github-oauth-application.png><img alt="GitHub OAuth configuration" src=../../img/guides/setting-up-dex/github-oauth-application.png></a></p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>github-client<span class=w> </span><span class=se>\</span>
--namespace<span class=o>=</span>dex<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span>client-id<span class=o>=</span><span class=si>${</span><span class=nv>GITHUB_CLIENT_ID</span><span class=si>}</span><span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span>client-secret<span class=o>=</span><span class=si>${</span><span class=nv>GITHUB_CLIENT_SECRET</span><span class=si>}</span>
</code></pre></div> <h4 id=deploy-dex>Deploy Dex<a class=headerlink href=#deploy-dex title="Permanent link">¶</a></h4> <p>Use <code>HelmRepository</code> and <code>HelmRelease</code> objects to let Flux deploy everything.</p> <details class=example> <summary>Expand to see resource manifests</summary> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">source.toolkit.fluxcd.io/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HelmRepository</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex</span>
<span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class=nt>url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://charts.dexidp.io</span>
<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">helm.toolkit.fluxcd.io/v2beta1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HelmRelease</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex</span>
<span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=nt>chart</span><span class=p>:</span>
<span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>    </span><span class=nt>chart</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex</span>
<span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.15.3</span>
<span class=w>    </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HelmRepository</span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex</span>
<span class=w>        </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex</span>
<span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class=nt>values</span><span class=p>:</span>
<span class=w>    </span><span class=nt>envVars</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GITHUB_CLIENT_ID</span>
<span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span>
<span class=w>        </span><span class=nt>secretKeyRef</span><span class=p>:</span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github-client</span>
<span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">client-id</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GITHUB_CLIENT_SECRET</span>
<span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span>
<span class=w>        </span><span class=nt>secretKeyRef</span><span class=p>:</span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github-client</span>
<span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">client-secret</span>
<span class=w>    </span><span class=nt>config</span><span class=p>:</span>
<span class=w>    </span><span class=c1># Set it to a valid URL</span>
<span class=w>    </span><span class=nt>issuer</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://dex.dev.example.tld</span>

<span class=w>    </span><span class=c1># See https://dexidp.io/docs/storage/ for more options</span>
<span class=w>    </span><span class=nt>storage</span><span class=p>:</span>
<span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">memory</span>

<span class=w>    </span><span class=nt>staticClients</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>'Weave</span><span class=nv> </span><span class=s>GitOps'</span>
<span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">weave-gitops</span>
<span class=w>        </span><span class=nt>secret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AiAImuXKhoI5ApvKWF988txjZ+6rG3S7o6X5En</span>
<span class=w>        </span><span class=nt>redirectURIs</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'https://localhost:9001/oauth2/callback'</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'https://0.0.0.0:9001/oauth2/callback'</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'http://0.0.0.0:9001/oauth2/callback'</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'http://localhost:4567/oauth2/callback'</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'https://localhost:4567/oauth2/callback'</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>'http://localhost:3000/oauth2/callback'</span>

<span class=w>    </span><span class=nt>connectors</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github</span>
<span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github</span>
<span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitHub</span>
<span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">config</span><span class="p p-Indicator">:</span>
<span class=w>        </span><span class=nt>clientID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$GITHUB_CLIENT_ID</span>
<span class=w>        </span><span class=nt>clientSecret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$GITHUB_CLIENT_SECRET</span>
<span class=w>        </span><span class=nt>redirectURI</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://dex.dev.example.tld/callback</span>
<span class=w>        </span><span class=nt>orgs</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">weaveworks</span>
<span class=w>            </span><span class="l l-Scalar l-Scalar-Plain">teams</span><span class="p p-Indicator">:</span>
<span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">team-a</span>
<span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">team-b</span>
<span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">QA</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ww-test-org</span>
<span class=w>    </span><span class=nt>ingress</span><span class=p>:</span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>className</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class=w>    </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>        </span><span class=nt>cert-manager.io/cluster-issuer</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
<span class=w>    </span><span class=nt>hosts</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex.dev.example.tld</span>
<span class=w>        </span><span class=nt>paths</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class=w>            </span><span class="l l-Scalar l-Scalar-Plain">pathType</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ImplementationSpecific</span>
<span class=w>    </span><span class=nt>tls</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex.dev.example.tld</span>
<span class=w>        </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dex-dev-example-tld</span>
</code></pre></div> </details> <p>An important part of the configuration is the <code>orgs</code> field on the GitHub connector, which allows you to define groups within a GitHub organisation: </p> <div class=highlight><pre><span></span><code><span class=nt>orgs</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">weaveworks</span>
<span class=nt>teams</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">team-a</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">team-b</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">QA</span>
</code></pre></div> <p>In this example, the GitHub organisation is <code>weaveworks</code> and all members of the <code>team-a</code>, <code>team-b</code>, and <code>QA</code> teams can authenticate. Group membership is added to the user.</p> <p>Based on these groups, we can bind roles to groups:</p> <details class=example> <summary>Expand to see group role bindings</summary> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-test-user-read-resources</span>
<span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">flux-system</span>
<span class=nt>subjects</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Group</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">weaveworks:QA</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">flux-system</span>
<span class=nt>roleRef</span><span class=p>:</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-admin-role</span>
<span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-admin-role</span>
<span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">flux-system</span>
<span class=nt>rules</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>""</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"secrets"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"pods"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"apps"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"deployments"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"replicasets"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"kustomize.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"kustomizations"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"helm.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"helmreleases"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"source.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"buckets"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmcharts"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"gitrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"ocirepositories"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>""</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"events"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">]</span>
</code></pre></div> </details> <p>In the same way, we can bind cluster roles to a group:</p> <details class=example> <summary>Expand to see group cluster role bindings</summary> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">weaveworks:team-a</span>
<span class=nt>subjects</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Group</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">weaveworks:team-a</span>
<span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class=nt>roleRef</span><span class=p>:</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
<span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</code></pre></div> </details> <h4 id=set-up-a-static-user>Set up a Static User<a class=headerlink href=#set-up-a-static-user title="Permanent link">¶</a></h4> <p>For a static user, add <code>staticPasswords</code> to the <code>config</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>spec</span><span class=p>:</span>
<span class=nt>values</span><span class=p>:</span>
<span class=w>    </span><span class=nt>config</span><span class=p>:</span>
<span class=w>    </span><span class=nt>staticPasswords</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class=s>"admin@example.tld"</span>
<span class=w>        </span><span class=nt>hash</span><span class=p>:</span><span class=w> </span><span class=s>"$2a$10$2b2cU8CPhOTaGrs1HRQuAueS7JTT5ZHsHSzYiFPm1leZck7Mc8T4W"</span>
<span class=w>        </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=s>"admin"</span>
<span class=w>        </span><span class=nt>userID</span><span class=p>:</span><span class=w> </span><span class=s>"08a8684b-db88-4b73-90a9-3cd1661f5466"</span>
</code></pre></div> <p>Generate a static user password via the <code>gitops</code> CLI:</p> <div class=highlight><pre><span></span><code><span class=nv>PASSWORD</span><span class=o>=</span><span class=s2>"&lt;your password&gt;"</span>
<span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=nv>$PASSWORD</span><span class=w> </span><span class=p>|</span><span class=w> </span>gitops<span class=w> </span>get<span class=w> </span>bcrypt-hash
<span class=nv>$2</span>a<span class=nv>$10$OS5NJmPNEb13UgTOSKnMxOWlmS7mlxX77hv4yAiISvZ71Dc7IuN3q</span>
</code></pre></div> <h4 id=oidc-login>OIDC Login<a class=headerlink href=#oidc-login title="Permanent link">¶</a></h4> <p>Using the "Login with OIDC Provider" button:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=../../img/guides/setting-up-dex/oidc-login.png><img alt="Login page" src=../../img/guides/setting-up-dex/oidc-login.png></a></p> <p>We have to authorize the GitHub OAuth application:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=../../img/guides/setting-up-dex/github-auth.png><img alt="GitHub OAuth page" src=../../img/guides/setting-up-dex/github-auth.png></a></p> <p>After that, grant access to Dex:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=../../img/guides/setting-up-dex/dex-auth.png><img alt="Dex grant access" src=../../img/guides/setting-up-dex/dex-auth.png></a></p> <p>Now we are logged in with our GitHub user and can see all of the resources we have access to:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=../../img/guides/setting-up-dex/ui-logged-in.png><img alt="UI logged in" src=../../img/guides/setting-up-dex/ui-logged-in.png></a></p> </div> <div class=tabbed-block> <div class="admonition danger"> <p class=admonition-title>Important</p> <p>This is an <strong>insecure</strong> method of securing your dashboard which we only recommend for local and development environments, or if you need to activate emergency access to a damaged cluster.</p> <p>Note also that this mechanism only exists for a single user. You will not be able to create multiple users. Weave GitOps does not provide its own authentication mechanism. For secure and fully-featured authentication we <strong>strongly recommend</strong> using an OIDC provider, as described in the other tab.</p> </div> <h4 id=configuring-the-emergency-user>Configuring the Emergency User<a class=headerlink href=#configuring-the-emergency-user title="Permanent link">¶</a></h4> <p>Before you log in via the emergency user account, you need to generate a bcrypt hash for your chosen password and store it as a secret in Kubernetes. There are several different ways to generate a bcrypt hash. This guide uses <code>gitops get bcrypt-hash</code> from our CLI.</p> <p>Generate the password by running:</p> <div class=highlight><pre><span></span><code><span class=nv>PASSWORD</span><span class=o>=</span><span class=s2>"&lt;your password&gt;"</span>
<span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=nv>$PASSWORD</span><span class=w> </span><span class=p>|</span><span class=w> </span>gitops<span class=w> </span>get<span class=w> </span>bcrypt-hash
<span class=nv>$2</span>a<span class=nv>$10$OS5NJmPNEb13UgTOSKnMxOWlmS7mlxX77hv4yAiISvZ71Dc7IuN3q</span>
</code></pre></div> <p>Now create a Kubernetes secret to store your chosen username and the password hash:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>cluster-user-auth<span class=w> </span><span class=se>\</span>
--namespace<span class=w> </span>flux-system<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>username</span><span class=o>=</span>wego-admin<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=nv>password</span><span class=o>=</span><span class=s1>'$2a$10$OS5NJmPNEb13UTOSKngMxOWlmS7mlxX77hv4yAiISvZ71Dc7IuN3q'</span>
</code></pre></div> <p>You should now be able to login via the cluster user account using your chosen username and password.</p> <h4 id=updating-the-emergency-user>Updating the Emergency User<a class=headerlink href=#updating-the-emergency-user title="Permanent link">¶</a></h4> <p>To change either the username or the password, recreate the <code>cluster-user-auth</code> with the new details.</p> <p>Only one emergency user can be created this way. To add more users, enable an OIDC provider.</p> <h4 id=user-permissions>User Permissions<a class=headerlink href=#user-permissions title="Permanent link">¶</a></h4> <p>By default, both a ClusterRole and Role are generated for the emergency user. Both have the same permissions, with the former being optional and the latter being bound to the <code>flux-system</code> namespace (where Flux stores its resources by default). The default set of rules are configured like this:</p> <div class=highlight><pre><span></span><code><span class=nt>rules</span><span class=p>:</span>
<span class=c1># Flux Resources</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"source.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"buckets"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmcharts"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"gitrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"ocirepositories"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"kustomize.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"kustomizations"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"helm.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"helmreleases"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"notification.toolkit.fluxcd.io"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"providers"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"alerts"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"infra.contrib.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"terraforms"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class=c1># Read access for all other Kubernetes objects</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"*"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"*"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class=w> </span><span class="p p-Indicator">]</span>
</code></pre></div> <p>These permissions give the emergency user Administrator-level powers. <strong>We do not advise leaving it active on production systems</strong>.</p> <p>If required, the permissions can be expanded with the <code>rbac.additionalRules</code> field in the <a href=../../references/helm-reference/ >Helm Chart</a>. Follow the instructions in the next section in order to configure RBAC correctly.</p> <details class=note open=open> <summary>Note</summary> <p>To remove the emergency user as a login method, set the following values in the <a href=../../references/helm-reference/ >Helm Chart</a>:</p> <div class=highlight><pre><span></span><code><span class=c1>#</span>
<span class=nt>adminUser</span><span class=p>:</span>
<span class=nt>create</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=c1>#</span>
<span class=nt>additionalArgs</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--auth-methods=oidc</span>
<span class=c1>#</span>
</code></pre></div> <p>If you are disabling an already existing emergency user, you will need to manually delete the Kubernetes Secret and any User Roles that were created on the cluster.</p> </details> </div> </div> </div> <h3 id=gitops-dashboard-service-account-permissions>GitOps Dashboard Service Account Permissions<a class=headerlink href=#gitops-dashboard-service-account-permissions title="Permanent link">¶</a></h3> <p>This section covers the service account <a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/ >permissions</a> for the Weave GitOps application, which the WGE UI requires to work. The default permissions will generate a cluster role that includes the permissions:</p> <div class=highlight><pre><span></span><code><span class=nt>rules</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>""</span><span class="p p-Indicator">]</span>
<span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>  </span><span class="p p-Indicator">[</span><span class=s>"users"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"groups"</span><span class="p p-Indicator">]</span><span class=w> </span>
<span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"impersonate"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>""</span><span class="p p-Indicator">]</span>
<span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"secrets"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>""</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"namespaces"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
</code></pre></div> <p>These allow the pod to do three things: - <a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/#user-impersonation>Impersonate</a> the user and operate in the cluster as them - Read the available namespaces; this is required to understand users' permissions - Read the <code>cluster-user-auth</code> and <code>oidc-auth</code> secrets, the default secrets to store the emergency cluster user account and OIDC configuration (see <a href=#securing-access-to-the-dashboard>securing access to the dashboard</a>)</p> <h4 id=impersonation>Impersonation<a class=headerlink href=#impersonation title="Permanent link">¶</a></h4> <p>The primary way Weave GitOps queries the Kube API is via <code>impersonation</code>. The permissions granted to users and groups that Weave GitOps can impersonate will determine the scope of actions that WGE can take within your cluster. </p> <p>The application, not the cluster, authenticates the user, either via the <a href=#configuring-the-emergency-user>emergency cluster user</a> credentials or OIDC. Then it makes Kube API calls on the user's behalf. This is equivalent to making a kubectl call like:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>deployments<span class=w> </span>--as<span class=w> </span>aisha@example.com
</code></pre></div> <p>Assuming the user <code>aisha@example.com</code> has permissions to get deployments within the cluster, this will return those deployments. The same occurs within the application, so properly configuring application permissions is very important. Without proper restrictions the application can impersonate very powerful <code>users</code> or <code>groups</code>. For example, the <code>system:masters</code> is a group generally bound to the <code>cluster-admin</code> role, which can do anything.</p> <h4 id=get-namespaces>Get Namespaces<a class=headerlink href=#get-namespaces title="Permanent link">¶</a></h4> <p>The application itself uses get namespace permissions to pre-cache the list of available namespaces. As the user accesses resources their permissions within various namespaces is also cached to speed up future operations.</p> <h4 id=reading-the-cluster-user-auth-and-oidc-auth-secrets>Reading the <code>cluster-user-auth</code> and <code>oidc-auth</code> Secrets<a class=headerlink href=#reading-the-cluster-user-auth-and-oidc-auth-secrets title="Permanent link">¶</a></h4> <p>The <code>cluster-user-auth</code> and <code>oidc-auth</code> secrets provide information for authenticating to the application. The former holds the username and bcrypt-hashed password for the <a href=#configuring-the-emergency-user>emergency user</a>, and the latter holds OIDC configuration.</p> <p>The application needs to be able to access these secrets in order to authenticate users.</p> <h3 id=user-permissions_1>User Permissions<a class=headerlink href=#user-permissions_1 title="Permanent link">¶</a></h3> <p>This section discusses the <a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/ >Kubernetes permissions</a> needed by Weave GitOps application users and groups. At a minimum, a User should be bound to a Role in the <code>flux-system</code> namespace—which is where Flux stores its resources by default—with the following permissions:</p> <div class=highlight><pre><span></span><code><span class=nt>rules</span><span class=p>:</span>
<span class=w>  </span><span class=c1># Flux Resources</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"source.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"buckets"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmcharts"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"gitrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"ocirepositories"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"kustomize.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"kustomizations"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"helm.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"helmreleases"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"notification.toolkit.fluxcd.io"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"providers"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"alerts"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"infra.contrib.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"terraforms"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>

<span class=w>  </span><span class=c1># Read access for all other Kubernetes objects</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"*"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"*"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class=w> </span><span class="p p-Indicator">]</span>
</code></pre></div> <p>For a wider scope, the User can be bound to a ClusterRole with the same set.</p> <p>On top of this you can add other permissions to view WGE resources like <code>GitOpsSets</code> and <code>Templates</code>.</p> <h4 id=flux-resources>Flux Resources<a class=headerlink href=#flux-resources title="Permanent link">¶</a></h4> <p>The following table lists resources that Flux works with directly.</p> <table> <thead> <tr> <th>API Group</th> <th>Resources</th> <th>Permissions</th> </tr> </thead> <tbody> <tr> <td>kustomize.toolkit.fluxcd.io</td> <td>kustomizations</td> <td>get, list, patch</td> </tr> <tr> <td>helm.toolkit.fluxcd.io</td> <td>Helm Releases</td> <td>get, list, patch</td> </tr> <tr> <td>source.toolkit.fluxcd.io</td> <td>buckets, Helm charts, Git repositories, Helm repositories, OCI repositories</td> <td>get, list, patch</td> </tr> <tr> <td>notification.toolkit.fluxcd.io</td> <td>providers, alerts</td> <td>get, list</td> </tr> <tr> <td>infra.contrib.fluxcd.io</td> <td><a href=https://github.com/weaveworks/tf-controller>Terraform</a></td> <td>get, list, patch</td> </tr> </tbody> </table> <p>Weave GitOps needs to be able to query the <a href=https://fluxcd.io/docs/components/ >CRDs</a> that Flux uses before it can accurately display Flux state. The <code>get</code> and <code>list</code> permissions facilitate this.</p> <p>The <code>patch</code> permissions are used for two features: to suspend and resume reconciliation of a resource by modifying the 'spec' of a resource, and to force reconciliation of a resource by modifying resource annotations. These features work in the same way that <code>flux suspend</code>, <code>flux resume</code>, and <code>flux reconcile</code> does on the CLI.</p> <h4 id=resources-managed-via-flux>Resources Managed via Flux<a class=headerlink href=#resources-managed-via-flux title="Permanent link">¶</a></h4> <table> <thead> <tr> <th>API Group</th> <th>Resources</th> <th>Permissions</th> </tr> </thead> <tbody> <tr> <td>""</td> <td>configmaps, secrets, pods, services, persistent volumes, persistent volume claims</td> <td>get, list, watch</td> </tr> <tr> <td>apps</td> <td>deployments, replica sets, stateful sets</td> <td>get, list, watch</td> </tr> <tr> <td>batch</td> <td>jobs, cron jobs</td> <td>get, list, watch</td> </tr> <tr> <td>autoscaling</td> <td>horizontal pod autoscalers</td> <td>get, list, watch</td> </tr> <tr> <td>rbac.authorization.k8s.io</td> <td>roles, cluster roles, rolebindings, cluster role bindings</td> <td>get, list, watch</td> </tr> <tr> <td>networking.k8s.io</td> <td>ingresses</td> <td>get, list, watch</td> </tr> </tbody> </table> <p>Weave GitOps reads basic resources so that it can monitor the effect that Flux has on what's running.</p> <p>Reading <code>secrets</code> enables Weave GitOps to monitor the state of Helm releases as that's where it stores the <a href=https://helm.sh/docs/faq/changes_since_helm2/#secrets-as-the-default-storage-driver>state by default</a>. For clarity this these are the Helm release objects <em>not</em> the Flux HelmRelease resource (which are dealt with by the earlier section).</p> <h4 id=feedback-from-flux>Feedback from Flux<a class=headerlink href=#feedback-from-flux title="Permanent link">¶</a></h4> <p>Flux communicates the status of itself primarily via events. These events will show when reconciliations start and stop, whether they're successful, and information as to why they're not.</p> <h3 id=login-ui>Login UI<a class=headerlink href=#login-ui title="Permanent link">¶</a></h3> <p>The label of the OIDC button on the login screen is configurable via a feature flag environment variable. This can give your users a more familiar experience when logging in.</p> <p>Adjust the configuration in the Helm <code>values.yaml</code> file or the <code>spec.values</code> section of the Weave GitOps <code>HelmRelease</code> resource:</p> <div class=highlight><pre><span></span><code><span class=nt>extraEnvVars</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">WEAVE_GITOPS_FEATURE_OIDC_BUTTON_LABEL</span>
<span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>"Login</span><span class=nv> </span><span class=s>with</span><span class=nv> </span><span class=s>ACME"</span>
</code></pre></div> <h2 id=recommended-rbac-configuration>Recommended RBAC Configuration<a class=headerlink href=#recommended-rbac-configuration title="Permanent link">¶</a></h2> <p>This section is purposefully vague as we intend to give a broad idea of how to implement such a system. The specifics will dependent on your circumstances and goals.</p> <p>Our general recommendation is to use OIDC and a small number of groups that Weave GitOps can impersonate.</p> <p>Configuring Weave GitOps to impersonate Kubernetes groups rather than users has the following benefits: - A user's permissions for impersonation by Weave GitOps can be separate from any other permissions that they may or may not have within the cluster. - Users do not have to be individually managed within the cluster and can have their permissions managed together.</p> <h3 id=example-setup>Example Setup<a class=headerlink href=#example-setup title="Permanent link">¶</a></h3> <p>Assume that your company has the following people in OIDC: - Aisha, a cluster admin, who should have full admin access to Weave GitOps - Brian, lead of Team-A, who should have admin permissions to their team's namespace in Weave GitOps and read-only otherwise - June and Jo, developers in Team-A who should have read-only access to Weave GitOps</p> <p>You can then create three groups:</p> <ul> <li><code>wego-admin</code></li> <li>Bound to the <code>ClusterRole</code>, created by Helm, <code>wego-admin-cluster-role</code></li> <li>Aisha is the only member</li> <li><code>wego-team-a-admin</code></li> <li>Bound to a <code>Role</code>, using the same permissions as <code>wego-admin-role</code>, created in Team-A's namespace</li> <li>Brian and Aisha are members</li> <li><code>wego-readonly</code></li> <li>Bound to a <code>ClusterRole</code> that matches <code>wego-admin-cluster-role</code> but with no <code>patch</code> permissions.</li> <li>Aisha, Brian, June and Jo are all members</li> </ul> <div class="admonition warning"> <p class=admonition-title>Using OIDC for cluster and Weave GitOps Authentication</p> <p>If the same OIDC provider is used to authenticate a user with the cluster itself (e.g. for use with <code>kubectl</code>) and to Weave GitOps then, depending on OIDC configuration, they may end up with the super-set of their permissions from Weave GitOps and any other permissions granted to them.</p> <p>This can lead to unintended consequences, like viewing <code>secrets</code>. To avoid this, OIDC providers will often let you configure which groups are returned to which clients. The Weave GitOps groups should not be returned to the cluster client (and vice versa).</p> </div> <h3 id=code>Code<a class=headerlink href=#code title="Permanent link">¶</a></h3> <p>The yaml to configure these permissions would look roughly like:</p> <details class=example> <summary>Expand to see example RBAC</summary> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=c1># Admin cluster role</span>
<span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-admin-cluster-role</span>
<span class=w>    </span><span class=nt>rules</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>""</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"secrets"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"pods"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"apps"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"deployments"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"replicasets"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"kustomize.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"kustomizations"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"helm.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"helmreleases"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"source.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"buckets"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmcharts"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"gitrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"ocirepositories"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"patch"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>""</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"events"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">---</span>
<span class=w>    </span><span class=c1># Read-only cluster role</span>
<span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-readonly-role</span>
<span class=w>    </span><span class=nt>rules</span><span class=p>:</span>
<span class=w>    </span><span class=c1># All the 'patch' permissions have been removed</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>""</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"secrets"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"pods"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"apps"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"deployments"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"replicasets"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"kustomize.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"kustomizations"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"helm.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"helmreleases"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"source.toolkit.fluxcd.io"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"buckets"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmcharts"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"gitrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"helmrepositories"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"ocirepositories"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class=w> </span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>""</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"events"</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"get"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"watch"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"list"</span><span class="p p-Indicator">]</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">---</span>
<span class=w>    </span><span class=c1># Bind the cluster admin role to the wego-admin group</span>
<span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-cluster-admin</span>
<span class=w>    </span><span class=nt>subjects</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Group</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-admin</span><span class=w> </span><span class=c1># only Aisha is a member</span>
<span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class=w>    </span><span class=nt>roleRef</span><span class=p>:</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-admin-cluster-role</span>
<span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">---</span>
<span class=w>    </span><span class=c1># Bind the admin role in the team-a namespace for the wego-team-a-admin group</span>
<span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-team-a-admin-role</span>
<span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">team-a</span>
<span class=w>    </span><span class=nt>subjects</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Group</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-team-a-admin</span><span class=w> </span><span class=c1># Aisha &amp; Brian are members</span>
<span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class=w>    </span><span class=nt>roleRef</span><span class=p>:</span>
<span class=w>    </span><span class=c1># Use the cluster role to set rules, just bind them in the team-a namespace</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-admin-role</span>
<span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">---</span>
<span class=w>    </span><span class=c1># Bind the read-only role to the read-only group</span>
<span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-readonly-role</span>
<span class=w>    </span><span class=nt>subjects</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Group</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-readonly</span><span class=w> </span><span class=c1># Everyone is a member</span>
<span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class=w>    </span><span class=nt>roleRef</span><span class=p>:</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wego-readonly-role</span>
<span class=w>    </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">---</span>
</code></pre></div> </details> <h2 id=configure-access-for-writing-to-git-from-the-weave-gitops-enterprise-ui>Configure Access for Writing to Git from the Weave GitOps Enterprise UI<a class=headerlink href=#configure-access-for-writing-to-git-from-the-weave-gitops-enterprise-ui title="Permanent link">¶</a></h2> <p>Here we provide guidance for GitHub, GitLab, BitBucket Server, and Azure DevOps.</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:3><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><input id=__tabbed_4_3 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>GitHub</label><label for=__tabbed_4_2>BitBucket Server</label><label for=__tabbed_4_3>Azure DevOps</label></div> <div class=tabbed-content> <div class=tabbed-block> <p>GitHub requires no additional configuration for OAuth git access <tabitem label=GitLab value=gitlab></tabitem></p> <p>Create a GitLab OAuth application that will request <code>api</code> permissions to create pull requests on your behalf.</p> <p>Follow the <a href=https://docs.gitlab.com/ee/integration/oauth_provider.html>GitLab docs</a>.</p> <p>The application should have at least these scopes:</p> <ul> <li><code>api</code></li> <li><code>openid</code></li> <li><code>email</code></li> <li><code>profile</code></li> </ul> <p>Add callback URLs to the application for each address the UI will be exposed on, e.g.:</p> <ul> <li><code>https://localhost:8000/oauth/gitlab</code> for port-forwarding and testing</li> <li><code>https://git.example.com/oauth/gitlab</code> for production use</li> </ul> <p>Save your application, taking note of the <strong>Client ID</strong> and <strong>Client Secret</strong>. Save them into the <code>git-provider-credentials</code> secret, along with:</p> <ul> <li><code>GIT_HOST_TYPES</code> to tell WGE that the host is gitlab</li> <li><code>GITLAB_HOSTNAME</code> where the OAuth app is hosted</li> </ul> <p><strong>Replace values</strong> in this snippet and run:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>git-provider-credentials<span class=w> </span>--namespace<span class=o>=</span>flux-system<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"GITLAB_CLIENT_ID=13457"</span><span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"GITLAB_CLIENT_SECRET=24680"</span><span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"GITLAB_HOSTNAME=git.example.com"</span><span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"GIT_HOST_TYPES=git.example.com=gitlab"</span>
</code></pre></div> </div> <div class=tabbed-block> <p>Create a new <a href=https://confluence.atlassian.com/bitbucketserver/configure-an-incoming-link-1108483657.html>incoming application link</a> from the BitBucket administration dashboard. You will be asked to enter a unique name and the redirect URL for the external application. The redirect URL should be set to <code>&lt;WGE dashboard URL&gt;/oauth/bitbucketserver</code>. You will also need to select permissions for the application. The minimum set of permissions needed for WGE to create pull requests on behalf of users is <code>Repositories - Write</code>. An example of configuring these settings is shown below.</p> <p><figure markdown=1> <a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=/img/oauth-bitbucket.png><img alt=oauthBitbucket loading=lazy src=/img/oauth-bitbucket.png width=500></a> <figcaption>Configuring a new incoming application link</figcaption> </figure></p> <p>Save your application and take note of the <strong>Client ID</strong> and <strong>Client Secret</strong>. Save them into the <code>git-provider-credentials</code> secret, along with:</p> <ul> <li><code>GIT_HOST_TYPES</code> to tell WGE that the host is bitbucket-server</li> <li><code>BITBUCKET_SERVER_HOSTNAME</code> where the OAuth app is hosted</li> </ul> <p><strong>Replace values</strong> in this snippet and run:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>git-provider-credentials<span class=w> </span>--namespace<span class=o>=</span>flux-system<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"BITBUCKET_SERVER_CLIENT_ID=13457"</span><span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"BITBUCKET_SERVER_CLIENT_SECRET=24680"</span><span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"BITBUCKET_SERVER_HOSTNAME=git.example.com"</span><span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"GIT_HOST_TYPES=git.example.com=bitbucket-server"</span>
</code></pre></div> <p>If the secret is already present, use the following command to update it using your default editor:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>edit<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>git-provider-credentials<span class=w> </span>--namespace<span class=o>=</span>flux-system
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If BitBucket Server is running on the default port (7990), make sure you include the port number in the values of the secret. For example: <code>GIT_HOST_TYPES=git.example.com:7990=bitbucket-server</code></p> </div> </div> <div class=tabbed-block> <p>Navigate to <a href=https://app.vsaex.visualstudio.com/app/register>VisualStudio</a> and register a new application, as explained in the <a href="https://learn.microsoft.com/en-us/azure/devops/integrate/get-started/authentication/oauth?view=azure-devops#1-register-your-app">docs</a>. Set the authorization callback URL and select which scopes to grant. Set the callback URL to <code>&lt;WGE dashboard URL&gt;/oauth/azuredevops</code>. </p> <p>Select the <code>Code (read and write)</code> scope from the list. This is necessary so that WGE can create pull requests on behalf of users. An example of configuring these settings is shown below.</p> <p><figure markdown=1> <a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=/img/oauth-azure-devops.png><img alt=oauthAzureDevOps loading=lazy src=/img/oauth-azure-devops.png></a> <figcaption>Creating a new application</figcaption> </figure></p> <p>After creating your application, you will be presented with the application settings. Take note of the <code>App ID</code> and <code>Client Secret</code> values—you will use them to configure WGE.</p> <p><figure markdown=1> <a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=/img/oauth-azure-devops-success.png><img alt=oauthAzureDevOpsSuccess loading=lazy src=/img/oauth-azure-devops-success.png></a> <figcaption>Application settings</figcaption> </figure></p> <p>In your cluster, create a secret named <code>git-provider-credentials</code> that contains the <code>App ID</code> and <code>Client Secret</code> values from the newly created application.</p> <p><strong>Replace values</strong> in this snippet and run:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>git-provider-credentials<span class=w> </span>--namespace<span class=o>=</span>flux-system<span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"AZURE_DEVOPS_CLIENT_ID=&lt;App ID value&gt;"</span><span class=w> </span><span class=se>\</span>
--from-literal<span class=o>=</span><span class=s2>"AZURE_DEVOPS_CLIENT_SECRET=&lt;Client Secret value&gt;"</span>
</code></pre></div> <p>WGE is now configured to ask users for authorization the next time a pull request must be created as part of using a template. Note that each user can view and manage which applications they have authorized by navigating to https://app.vsaex.visualstudio.com/me.</p> </div> </div> </div> <h2 id=tls-configuration>TLS Configuration<a class=headerlink href=#tls-configuration title="Permanent link">¶</a></h2> <p>By default, the WGE UI pod will listen on port <code>8000</code> with TLS enabled. WGE will generate and use a self-signed certificate for this purpose.</p> <p>It can then be accessed via port-forwarding:</p> <p><code>kubectl port-forward --namespace flux-system svc/clusters-service 8000:8000</code></p> <p>If you're using an ingress controller to terminate TLS you can disable it in the Helm release:</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=nt>values</span><span class=p>:</span>
<span class=w>    </span><span class=nt>tls</span><span class=p>:</span>
<span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div> <p>Other ingress conguration changes can be made via the ingress configuration</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=nt>values</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ingress</span><span class=p>:</span>
<span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>      </span><span class="l l-Scalar l-Scalar-Plain">... other parameters specific to the ingress type ...</span>
</code></pre></div> <h2 id=configure-helm-chart-and-commit>Configure Helm Chart and Commit<a class=headerlink href=#configure-helm-chart-and-commit title="Permanent link">¶</a></h2> <p>We deploy WGE via a Helm chart. We'll save and adapt the below template before committing it in Git to a Flux-reconciled path.</p> <p>Clone the newly created repo locally. We're gonna add some things!</p> <div class=highlight><pre><span></span><code>git<span class=w> </span>clone<span class=w> </span>git@&lt;provider&gt;:&lt;username&gt;/fleet-infra
<span class=nb>cd</span><span class=w> </span>fleet-infra
</code></pre></div> <p>Download the helm-release to <code>clusters/management/weave-gitops-enterprise.yaml</code>.</p> <p>import ExampleWGE from "../assets/example-enterprise-helm.yaml"; import ExampleWGEContent from "!!raw-loader!../assets/example-enterprise-helm.yaml";</p> <details class=example> <summary>Expand to see file contents</summary> <p><curlcodeblock content={ExampleWGEContent} hostedpath={ExampleWGE} localpath=clusters/management/weave-gitops-enterprise.yaml></curlcodeblock></p> </details> <p>Once you have copied the above file, open and adjust the following configuration options:</p> <h4 id=valuesconfigcapirepositoryurl><code>values.config.capi.repositoryURL</code><a class=headerlink href=#valuesconfigcapirepositoryurl title="Permanent link">¶</a></h4> <p>Ensure this has been set to your repository URL.</p> <h4 id=valuesconfigcapirepositorypath><code>values.config.capi.repositoryPath</code><a class=headerlink href=#valuesconfigcapirepositorypath title="Permanent link">¶</a></h4> <p>By default, WGE will create new clusters in the <code>clusters/management/clusters</code> path. You can configure it with <code>values.config.capi.repositoryPath</code>. You might what to change it to <code>clusters/my-cluster/cluster</code> if you configured Flux to reconcile <code>./clusters/my-cluster</code> instead.</p> <h4 id=valuesconfigcapirepositoryclusterspath><code>values.config.capi.repositoryClustersPath</code><a class=headerlink href=#valuesconfigcapirepositoryclusterspath title="Permanent link">¶</a></h4> <p>The other important path to configure is where you'll store applications and workloads run on the new cluster. By default this is <code>./clusters</code>. When a new cluster is specified, any selected profiles will be written to <code>./clusters/{.namespace}/{.clusterName}/profiles.yaml</code>. When the new cluster is bootstrapped, Flux will sync the <code>./clusters/{.namespace}/{.clusterName}</code> path.</p> <h2 id=configure-your-password>Configure Your Password<a class=headerlink href=#configure-your-password title="Permanent link">¶</a></h2> <p>To login to the WGE UI, generate a bcrypt hash for your chosen password and store it as a secret in the Kubernetes cluster. There are several different ways to generate a bcrypt hash. Here, we'll use <code>gitops get bcrypt-hash</code> from our CLI.</p> <div class=highlight><pre><span></span><code><span class=nv>PASSWORD</span><span class=o>=</span><span class=s2>"&lt;Make up and insert a brand-new password here&gt;"</span>
<span class=nb>echo</span><span class=w> </span>-n<span class=w> </span><span class=nv>$PASSWORD</span><span class=w> </span><span class=p>|</span><span class=w> </span>gitops<span class=w> </span>get<span class=w> </span>bcrypt-hash<span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>cluster-user-auth<span class=w> </span>-n<span class=w> </span>flux-system<span class=w> </span>--from-literal<span class=o>=</span><span class=nv>username</span><span class=o>=</span>wego-admin<span class=w> </span>--from-file<span class=o>=</span><span class=nv>password</span><span class=o>=</span>/dev/stdin
</code></pre></div> <p>A validation to know it’s working:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>-n<span class=w> </span>flux-system<span class=w> </span>cluster-user-auth
</code></pre></div> <h3 id=optional-install-policy-agent>(Optional) Install Policy Agent<a class=headerlink href=#optional-install-policy-agent title="Permanent link">¶</a></h3> <p><a href=../../policy/ >Policy agent</a> comes packaged with the WGE chart. To install it, set the following values:</p> <ul> <li><code>values.policy-agent.enabled</code>: set to true to install the agent with WGE</li> <li><code>values.policy-agent.config.accountId</code>: organization name, used as identifier</li> <li><code>values.policy-agent.config.clusterId</code>: unique identifier for the cluster</li> </ul> <p>Commit and push all the files</p> <div class=highlight><pre><span></span><code>git<span class=w> </span>add<span class=w> </span>clusters/management/weave-gitops-enterprise.yaml
git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>"Deploy Weave GitOps Enterprise"</span>
git<span class=w> </span>push
</code></pre></div> <p>Flux will reconcile the helm-release and WGE will be deployed into the cluster. You can check the <code>flux-system</code> namespace to verify all pods are running.</p> <h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">¶</a></h2> <p>Here are a couple of options for you to take your next steps with WGE. Explore one option or all of them, in no particular order.</p> <ul> <li><a href=https://docs.gitops.weave.works/docs/next/cluster-management/intro/ >Cluster Management</a>: We'll show you how to join WGE to a cluster and install an application on that cluster <em>without</em> using Cluster API. But if you prefer using Cluster API, our docs cover that too.</li> <li>Install the <a href=https://weaveworks.github.io/tf-controller/ >Terraform Controller</a> to reconcile your Terraform resources in a GitOps way. With Flux and the TF Controller, WGE makes it easy to add Terraform templates to your clusters and continuously reconcile any changes made to the Terraform source manifest.</li> <li>Install <a href=../../policy/ >Policy agent</a>, which comes packaged with the WGE chart.</li> </ul> <form class=md-feedback hidden name=feedback> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" data-md-value=1 title="This page was helpful" type=submit> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M5 9v12H1V9h4m4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21H9m0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03V19Z"></path></svg> </button> <button class="md-feedback__icon md-icon" data-md-value=0 title="This page could be improved" type=submit> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 15V3h4v12h-4M15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3h9m0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97V5Z"></path></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/eksctl-io/eksctl/issues/new/?title=[Feedback]+Install%20Weave%20GitOps%20Enterprise+-+/enterprise/install-enterprise/" rel=noopener target=_blank>feedback form <a>. </a></a></div> </div> </div> </fieldset> </form> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <a class="md-top md-icon" data-md-component=top hidden href=#> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </a> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: Introduction to Weave GitOps Enterprise" class="md-footer__link md-footer__link--prev" href=../ rel=prev> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Introduction to Weave GitOps Enterprise </div> </div> </a> <a aria-label="Next: Install Weave GitOps Enterprise via CLI" class="md-footer__link md-footer__link--next" href=../install-enterprise-cli/ rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Install Weave GitOps Enterprise via CLI </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <p>Site powered by <a href=https://netlify.com>Netlify ©</a></p> <p>Copyright © 2023 Weaveworks <br> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </p> </div> <div class=md-social> <a class=md-social__link href=https://www.facebook.com/WeaveworksInc/ rel=noopener target=_blank title=www.facebook.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg> </a> <a class=md-social__link href=https://www.linkedin.com/company/weaveworks rel=noopener target=_blank title=www.linkedin.com> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg> </a> <a class=md-social__link href=https://twitter.com/weaveworks rel=noopener target=_blank title=twitter.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> </a> <a class=md-social__link href=https://slack.weave.works/ rel=noopener target=_blank title=slack.weave.works> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"></path></svg> </a> <a class=md-social__link href=https://www.youtube.com/c/WeaveWorksInc rel=noopener target=_blank title=www.youtube.com> <svg viewbox="0 0 576 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent hidden id=__consent> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle id=__settings type=checkbox> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input checked name=analytics type=checkbox> <span class=task-list-indicator></span> Google Analytics <label> </label></label></li> <li class=task-list-item> <label class=task-list-control> <input checked name=github type=checkbox> <span class=task-list-indicator></span> GitHub <label> </label></label></li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "search.highlight", "search.share", "search.suggest", "content.code.annotate", "content.tooltips", "content.tabs.link", "content.code.copy"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> <script src=../../javascripts/extra.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>