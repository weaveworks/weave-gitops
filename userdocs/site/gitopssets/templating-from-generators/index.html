<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="The Flux expansion pack from the founders of Flux" name=description><meta content="Weave GitOps authors" name=author><link href=https://docs.gitops.weave.works/gitopssets/templating-from-generators/ rel=canonical><link href=../gitopssets-installation/ rel=prev><link href=../gitopssets-api-reference/ rel=next><link href=../../img/favicon_150px.png rel=icon><meta content="mkdocs-1.4.2, mkdocs-material-9.0.6" name=generator><title>Templating from Generators - Weave GitOps</title><link href=../../assets/stylesheets/main.558e4712.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.2505c338.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Segoe+UI:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Segoe UI";--md-code-font:"Roboto Mono"}</style><link href=../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta content=website property=og:type><meta content="Templating from Generators - Weave GitOps" property=og:title><meta content="The Flux expansion pack from the founders of Flux" property=og:description><meta content=https://docs.gitops.weave.works/assets/images/social/gitopssets/templating-from-generators.png property=og:image><meta content=image/png property=og:image:type><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content=https://docs.gitops.weave.works/gitopssets/templating-from-generators/ property=og:url><meta content=summary_large_image name=twitter:card><meta content="Templating from Generators - Weave GitOps" name=twitter:title><meta content="The Flux expansion pack from the founders of Flux" name=twitter:description><meta content=https://docs.gitops.weave.works/assets/images/social/gitopssets/templating-from-generators.png name=twitter:image><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=light-blue data-md-color-primary=deep-orange data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#templating-from-generators> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Weave GitOps" class="md-header__button md-logo" data-md-component=logo href=../.. title="Weave GitOps"> <img alt=logo src=../../img/logo.ico> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Weave GitOps </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Templating from Generators </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=light-blue data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary=deep-orange data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=light-blue data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary=deep-orange data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Share> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/weaveworks/weave-gitops title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> weaveworks/weave-gitops </div> </a> </div> </nav> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../..> Home </a> </li> <li class=md-tabs__item> <a href=../../intro-weave-gitops/ class="md-tabs__link md-tabs__link--active"> Docs </a> </li> <li class=md-tabs__item> <a href=../../references/helm-reference/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../security/ class=md-tabs__link> Security </a> </li> <li class=md-tabs__item> <a href=../../feedback-and-telemetry/ class=md-tabs__link> Feedback &amp; Telemetry </a> </li> <li class=md-tabs__item> <a href=../../help-and-support/ class=md-tabs__link> Support </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Weave GitOps" class="md-nav__button md-logo" data-md-component=logo href=../.. title="Weave GitOps"> <img alt=logo src=../../img/logo.ico> </a> Weave GitOps </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/weaveworks/weave-gitops title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> weaveworks/weave-gitops </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../..> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label aria-expanded=true class=md-nav__link for=__nav_2 tabindex=0> Docs <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Docs class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 id=__nav_2_1 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_1 tabindex=0> Introducing Weave GitOps <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Introducing Weave GitOps" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Introducing Weave GitOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../intro-weave-gitops/ class=md-nav__link> Introducing Weave GitOps </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_2 id=__nav_2_1_2 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_1_2 tabindex=0> Weave GitOps OSS <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Weave GitOps OSS" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_1_2> <span class="md-nav__icon md-icon"></span> Weave GitOps OSS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../open-source/install-oss/ class=md-nav__link> Step 1 - Install Weave GitOps Open Source </a> </li> <li class=md-nav__item> <a href=../../open-source/ui-oss/ class=md-nav__link> Step 2 - Explore the Open Source UI </a> </li> <li class=md-nav__item> <a href=../../open-source/deploy-oss/ class=md-nav__link> Step 3 - Deploy an Application </a> </li> <li class=md-nav__item> <a href=../../open-source/aws-marketplace/ class=md-nav__link> AWS Marketplace </a> </li> <li class=md-nav__item> <a href=../../open-source/run-ui-subpath/ class=md-nav__link> Optional: Running the UI on a Subpath </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_3 id=__nav_2_1_3 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_1_3 tabindex=0> Weave GitOps Enterprise <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Weave GitOps Enterprise" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_1_3> <span class="md-nav__icon md-icon"></span> Weave GitOps Enterprise </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../enterprise/ class=md-nav__link> Introduction to Weave GitOps Enterprise </a> </li> <li class=md-nav__item> <a href=../../enterprise/install-enterprise/ class=md-nav__link> Install Weave GitOps Enterprise </a> </li> <li class=md-nav__item> <a href=../../enterprise/install-enterprise-cli/ class=md-nav__link> Install Weave GitOps Enterprise via CLI </a> </li> <li class=md-nav__item> <a href=../../enterprise/install-enterprise-airgap/ class=md-nav__link> Install Enterprise in Air-gapped Environments </a> </li> <li class=md-nav__item> <a href=../../enterprise/releases-enterprise/ class=md-nav__link> Enterprise Releases </a> </li> <li class=md-nav__item> <a href=../../enterprise/install-enterprise-azure/ class=md-nav__link> Azure and Weave GitOps Enterprise Installation </a> </li> <li class=md-nav__item> <a href=../../enterprise/join-cluster-azure-flux/ class=md-nav__link> Join a Cluster with Azure Flux </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../backstage/ class=md-nav__link> Backstage </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 id=__nav_2_3 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_3 tabindex=0> Cluster Management <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Cluster Management" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Cluster Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cluster-management/ class=md-nav__link> Cluster Management - Introduction </a> </li> <li class=md-nav__item> <a href=../../cluster-management/managing-clusters-without-capi/ class=md-nav__link> Managing Clusters Without Cluster API </a> </li> <li class=md-nav__item> <a href=../../cluster-management/deploying-capa-eks/ class=md-nav__link> Deploying CAPA with EKS </a> </li> <li class=md-nav__item> <a href=../../cluster-management/profiles/ class=md-nav__link> Profiles </a> </li> <li class=md-nav__item> <a href=../../cluster-management/cluster-management-troubleshooting/ class=md-nav__link> Cluster Management Troubleshooting </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3_6 id=__nav_2_3_6 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_3_6 tabindex=0> Advanced Cluster management <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Advanced Cluster management" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_3_6> <span class="md-nav__icon md-icon"></span> Advanced Cluster management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cluster-management/advanced-cluster-management-topics/how-to-inject-credentials-into-template/ class=md-nav__link> How to Inject Credentials Into Your Template </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 id=__nav_2_4 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_4 tabindex=0> Explorer <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Explorer class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Explorer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../explorer/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../explorer/getting-started/ class=md-nav__link> Getting started </a> </li> <li class=md-nav__item> <a href=../../explorer/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../explorer/querying/ class=md-nav__link> Querying </a> </li> <li class=md-nav__item> <a href=../../explorer/operations/ class=md-nav__link> Operations </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5 id=__nav_2_5 type=checkbox> <label aria-expanded=true class=md-nav__link for=__nav_2_5 tabindex=0> GitOpsSets <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=GitOpsSets class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> GitOpsSets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../gitopssets-installation/ class=md-nav__link> Installation </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> Templating from Generators <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Templating from Generators </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#basics> Basics </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#general-behaviour> General behaviour </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#generation> Generation </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#rendering-templates> Rendering templates </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#repeating-templates> Repeating templates </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#delimiters> Delimiters </a> <nav aria-label=Delimiters class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#unquoted-values> Unquoted values </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#generators> Generators </a> <nav aria-label=Generators class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#list-generator> List generator </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gitrepository-generator> GitRepository generator </a> <nav aria-label="GitRepository generator" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#generation-from-files> Generation from files </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#generation-from-directories> Generation from directories </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#ocirepository-generator> OCIRepository generator </a> <nav aria-label="OCIRepository generator" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#generation-from-files_1> Generation from files </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#pullrequests-generator> PullRequests generator </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#matrix-generator> Matrix generator </a> <nav aria-label="Matrix generator" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#optional-name-for-matrix-elements> Optional Name for Matrix elements </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#single-element-for-matrix> Single Element for Matrix </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-generator> apiClient generator </a> <nav aria-label="apiClient generator" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-jsonpath> APIClient JSONPath </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-post-body> APIClient POST body </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-simple-results> APIClient simple results </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-custom-ca> APIClient Custom CA </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#cluster-generator> Cluster generator </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#imagepolicy-generator> ImagePolicy generator </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#config-generator> Config generator </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#templating-functions> Templating functions </a> <nav aria-label="Templating functions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#sanitize-template-function> sanitize template function </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#getordefault> getordefault </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#security> Security </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#limiting-via-service-accounts> Limiting via service-accounts </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gitopsset-controller-configuration> gitopsset-controller configuration </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#kubernetes-process-limits> Kubernetes Process Limits </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#notifications> Notifications </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../gitopssets-api-reference/ class=md-nav__link> API reference </a> </li> <li class=md-nav__item> <a href=../gitopssets-releases/ class=md-nav__link> Releases </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6 id=__nav_2_6 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_6 tabindex=0> Guides <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Guides class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/displaying-custom-metadata/ class=md-nav__link> Displaying Custom Metadata </a> </li> <li class=md-nav__item> <a href=../../guides/fluxga-upgrade/ class=md-nav__link> Upgrade to Flux GA </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../monitoring/ class=md-nav__link> Operations </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_8 id=__nav_2_8 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_8 tabindex=0> Pipelines <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Pipelines class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../pipelines/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../pipelines/pipelines-getting-started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../pipelines/authorization/ class=md-nav__link> Authorization </a> </li> <li class=md-nav__item> <a href=../../pipelines/promoting-applications/ class=md-nav__link> Promoting applications </a> </li> <li class=md-nav__item> <a href=../../pipelines/pipelines-templates/ class=md-nav__link> Using GitOpsTemplates for Pipelines </a> </li> <li class=md-nav__item> <a href=../../pipelines/pipelines-with-jenkins/ class=md-nav__link> Pipelines With Jenkins Webhook </a> </li> <li class=md-nav__item> <a href=../../pipelines/pipelines-with-tekton/ class=md-nav__link> Pipelines With Tekton </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_8_8 id=__nav_2_8_8 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_8_8 tabindex=0> Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Reference class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_8_8> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../pipelines/spec/v1alpha1/pipeline/ class=md-nav__link> v1alpha1 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_9 id=__nav_2_9 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_9 tabindex=0> Policy <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Policy class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> Policy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../policy/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../policy/getting-started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../policy/authorization/ class=md-nav__link> Authorization </a> </li> <li class=md-nav__item> <a href=../../policy/policy/ class=md-nav__link> Policy </a> </li> <li class=md-nav__item> <a href=../../policy/weave-policy-profile/ class=md-nav__link> Policy Profile </a> </li> <li class=md-nav__item> <a href=../../policy/policy-set/ class=md-nav__link> PolicySet </a> </li> <li class=md-nav__item> <a href=../../policy/policy-configuration/ class=md-nav__link> PolicyConfig </a> </li> <li class=md-nav__item> <a href=../../policy/releases/ class=md-nav__link> Profile Releases </a> </li> <li class=md-nav__item> <a href=../../policy/commit-time-checks/ class=md-nav__link> Commit/Build Time Checks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_10 id=__nav_2_10 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_10 tabindex=0> Progressive Delivery <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Progressive Delivery" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_10> <span class="md-nav__icon md-icon"></span> Progressive Delivery </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../progressive-delivery/progressive-delivery-flagger-install/ class=md-nav__link> Progressive Delivery Using Flagger </a> </li> <li class=md-nav__item> <a href=../../progressive-delivery/flagger-manual-gating/ class=md-nav__link> Manual Approval for Progressive Delivery Deployments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_11 id=__nav_2_11 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_11 tabindex=0> Secrets <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Secrets class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_11> <span class="md-nav__icon md-icon"></span> Secrets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../secrets/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../secrets/getting-started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../secrets/bootstrapping-secrets/ class=md-nav__link> Bootstrapping Secrets </a> </li> <li class=md-nav__item> <a href=../../secrets/setup-eso/ class=md-nav__link> Setup ESO </a> </li> <li class=md-nav__item> <a href=../../secrets/setup-sops/ class=md-nav__link> Setup SOPS </a> </li> <li class=md-nav__item> <a href=../../secrets/manage-secrets-ui/ class=md-nav__link> Manage Secrets UI </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_11_7 id=__nav_2_11_7 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_11_7 tabindex=0> Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Reference class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_11_7> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../secrets/spec/v1alpha1/secretSync/ class=md-nav__link> v1alpha1 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_12 id=__nav_2_12 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_12 tabindex=0> Templates <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Templates class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_12> <span class="md-nav__icon md-icon"></span> Templates </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gitops-templates/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_12_2 id=__nav_2_12_2 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_12_2 tabindex=0> Creating Templates <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Creating Templates" class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_12_2> <span class="md-nav__icon md-icon"></span> Creating Templates </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gitops-templates/creating-templates/ class=md-nav__link> Creating Templates </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/resource-templates/ class=md-nav__link> Resource Templates </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/repo-rendered-paths/ class=md-nav__link> Rendered Template Paths </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/profiles/ class=md-nav__link> Profiles </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/annotations/ class=md-nav__link> Annotations </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/params/ class=md-nav__link> Parameters </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/supported-langs/ class=md-nav__link> Supported Templating Languages </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/create-cluster-example/ class=md-nav__link> Example: Template to Create a CAPI Cluster </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/quickstart-templates/ class=md-nav__link> Quickstart </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../gitops-templates/cli/ class=md-nav__link> CLI </a> </li> <li class=md-nav__item> <a href=../../gitops-templates/versions/ class=md-nav__link> Version Information </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_13 id=__nav_2_13 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_13 tabindex=0> Terraform <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Terraform class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_13> <span class="md-nav__icon md-icon"></span> Terraform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../terraform/ class=md-nav__link> Introduction to Terraform Controller </a> </li> <li class=md-nav__item> <a href=../../terraform/get-started-terraform/ class=md-nav__link> Get Started </a> </li> <li class=md-nav__item> <a href=../../terraform/using-terraform-templates/ class=md-nav__link> Using Terraform Templates </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_14 id=__nav_2_14 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_2_14 tabindex=0> Workspaces <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Workspaces class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_14> <span class="md-nav__icon md-icon"></span> Workspaces </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../workspaces/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../workspaces/multi-tenancy/ class=md-nav__link> Multi Tenancy </a> </li> <li class=md-nav__item> <a href=../../workspaces/view-workspaces/ class=md-nav__link> Workspaces View </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 id=__nav_3 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_3 tabindex=0> Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Reference class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../references/helm-reference/ class=md-nav__link> OSS Helm Reference </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 id=__nav_3_2 type=checkbox> <label aria-expanded=false class=md-nav__link for=__nav_3_2 tabindex=0> CLI Reference <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="CLI Reference" class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> CLI Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../references/cli-reference/gitops/ class=md-nav__link> Gitops </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_check/ class=md-nav__link> Gitops check </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion/ class=md-nav__link> Gitops completion </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion_bash/ class=md-nav__link> Gitops completion bash </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion_fish/ class=md-nav__link> Gitops completion fish </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion_powershell/ class=md-nav__link> Gitops completion powershell </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_completion_zsh/ class=md-nav__link> Gitops completion zsh </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_create/ class=md-nav__link> Gitops create </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_create_dashboard/ class=md-nav__link> Gitops create dashboard </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_create_terraform/ class=md-nav__link> Gitops create terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_delete/ class=md-nav__link> Gitops delete </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_delete_terraform/ class=md-nav__link> Gitops delete terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_get/ class=md-nav__link> Gitops get </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_get_bcrypt-hash/ class=md-nav__link> Gitops get bcrypt hash </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_get_config/ class=md-nav__link> Gitops get config </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_logs/ class=md-nav__link> Gitops logs </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_logs_terraform/ class=md-nav__link> Gitops logs terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_replan/ class=md-nav__link> Gitops replan </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_replan_terraform/ class=md-nav__link> Gitops replan terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_resume/ class=md-nav__link> Gitops resume </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_resume_terraform/ class=md-nav__link> Gitops resume terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_set/ class=md-nav__link> Gitops set </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_set_config/ class=md-nav__link> Gitops set config </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_suspend/ class=md-nav__link> Gitops suspend </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_suspend_terraform/ class=md-nav__link> Gitops suspend terraform </a> </li> <li class=md-nav__item> <a href=../../references/cli-reference/gitops_version/ class=md-nav__link> Gitops version </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../feedback-and-telemetry/ class=md-nav__link> Feedback &amp; Telemetry </a> </li> <li class=md-nav__item> <a href=../../help-and-support/ class=md-nav__link> Support </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#basics> Basics </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#general-behaviour> General behaviour </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#generation> Generation </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#rendering-templates> Rendering templates </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#repeating-templates> Repeating templates </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#delimiters> Delimiters </a> <nav aria-label=Delimiters class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#unquoted-values> Unquoted values </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#generators> Generators </a> <nav aria-label=Generators class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#list-generator> List generator </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gitrepository-generator> GitRepository generator </a> <nav aria-label="GitRepository generator" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#generation-from-files> Generation from files </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#generation-from-directories> Generation from directories </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#ocirepository-generator> OCIRepository generator </a> <nav aria-label="OCIRepository generator" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#generation-from-files_1> Generation from files </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#pullrequests-generator> PullRequests generator </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#matrix-generator> Matrix generator </a> <nav aria-label="Matrix generator" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#optional-name-for-matrix-elements> Optional Name for Matrix elements </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#single-element-for-matrix> Single Element for Matrix </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-generator> apiClient generator </a> <nav aria-label="apiClient generator" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-jsonpath> APIClient JSONPath </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-post-body> APIClient POST body </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-simple-results> APIClient simple results </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apiclient-custom-ca> APIClient Custom CA </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#cluster-generator> Cluster generator </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#imagepolicy-generator> ImagePolicy generator </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#config-generator> Config generator </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#templating-functions> Templating functions </a> <nav aria-label="Templating functions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#sanitize-template-function> sanitize template function </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#getordefault> getordefault </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#security> Security </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#limiting-via-service-accounts> Limiting via service-accounts </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gitopsset-controller-configuration> gitopsset-controller configuration </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#kubernetes-process-limits> Kubernetes Process Limits </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#notifications> Notifications </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=templating-from-generators>Templating from Generators<a class=headerlink href=#templating-from-generators title="Permanent link">¶</a></h1> <h2 id=basics>Basics<a class=headerlink href=#basics title="Permanent link">¶</a></h2> <p>Currently rendering templates operates in two phases:</p> <ul> <li>Generate all template parameters from the configured generators</li> <li>Render all the templates for each set of template parameters</li> </ul> <p>Please read the <a href=#security>security information</a> below before using this.</p> <h2 id=general-behaviour>General behaviour<a class=headerlink href=#general-behaviour title="Permanent link">¶</a></h2> <p>GitOpsSets can be suspended, by setting the <code>spec.suspend</code> flag to be true.</p> <p>When this is the case, updates will not be applied, no resources created <em>or</em> deleted.</p> <p>In addition, a manual reconciliation can be requested by annotating a GitOpsSet with the <code>reconcile.fluxcd.io/requestedAt</code> annotation.</p> <h2 id=generation>Generation<a class=headerlink href=#generation title="Permanent link">¶</a></h2> <p>The simplest generator is the <code>List</code> generator.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>        </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-team</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ops-team</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ops-team</span>
</code></pre></div> <p>The elements in there are a set JSON of objects[^yaml], there are three in this example, and each of them has two keys, <code>env</code> and <code>team</code>.</p> <p>Other generators provide different sets of keys and values.</p> <p>The <a href=#generators>generators</a> documentation below provides more information on what the other generators output.</p> <h2 id=rendering-templates>Rendering templates<a class=headerlink href=#rendering-templates title="Permanent link">¶</a></h2> <p>Templates are Kubernetes resources in YAML format.</p> <p>Each template is rendered for each element generated by the generators.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>        </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-team</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ops-team</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ops-team</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.team</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
</code></pre></div> <p>The generated elements are provided to the template in the <code>Element</code> scope, so <code>.Element.dev</code> refers to the <code>dev</code> field from the List element.</p> <p>The output from all generators is exposed in the <code>Element</code> scope, not just List generators.</p> <p>In addition to the <code>.Element</code> field, a <code>.ElementIndex</code> is also available, this represents the zero-based index into the set of generated elements.</p> <p><strong>NOTE</strong>: It's not recommended that you use this to name resources where the ordering of the queries for generating the elements is not guaranteed to be ordered, otherwise you could generate churn in resources as we look for resources by name when updating them, so, <code>.ElementIndex</code> 1 may not be the same as <code>.ElementIndex</code> 1 was the previous time, and this could cause resources to be updated unnecessarily with undesirable effects.</p> <h2 id=repeating-templates>Repeating templates<a class=headerlink href=#repeating-templates title="Permanent link">¶</a></h2> <p>The output from a generator is an array of JSON objects[^yaml], the keys of which can contain repeating elements, either further JSON objects, or scalar values.</p> <p>It can be desirable to repeat a template for a repeated element in a generated value.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">repeated-gitopsset-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>        </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-team</span>
<span class=w>            </span><span class=nt>teams</span><span class=p>:</span>
<span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"team1"</span>
<span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"team2"</span>
<span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"team3"</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-team</span>
<span class=w>            </span><span class=nt>teams</span><span class=p>:</span>
<span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"team4"</span>
<span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"team5"</span>
<span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"team6"</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>repeat</span><span class=p>:</span><span class=w> </span><span class=s>"{</span><span class=nv> </span><span class=s>.teams</span><span class=nv> </span><span class=s>}"</span>
<span class=w>      </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Repeat.name</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>        </span><span class=nt>data</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Repeat.name</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.team</span><span class=nv> </span><span class=s>}}"</span>
</code></pre></div> <p>The template <code>repeat</code> field is a <a href=https://kubernetes.io/docs/reference/kubectl/jsonpath/ >JSONPath</a> expression that is applied to each element during the template rendering.</p> <p>Templates that use <code>repeat</code> will have two separate scopes for the template params, <code>.Element</code> which is the top-level element generated by the generator, and the additional <code>.Repeat</code> scope, which is the repeating element.</p> <p>In this case, six different <code>ConfigMaps</code> are generated, three for the "dev-team" and three for the "staging-team".</p> <p>As with the <code>.ElementIndex</code>, for repeated elements both <code>.ElementIndex</code> <strong>and</strong> <code>.RepeatIndex</code> are available.</p> <h2 id=delimiters>Delimiters<a class=headerlink href=#delimiters title="Permanent link">¶</a></h2> <p>The default delimiters for the template engine are <code>{{</code> and <code>}}</code>, which is the same as the Go template engine.</p> <p>These can be changed by adding an annotation to the <code>GitOpsSet</code>:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>templates.weave.works/delimiters</span><span class=p>:</span><span class=w> </span><span class=s>"${{,}}"</span>
</code></pre></div> <p>Changing the delimiters can useful for:</p> <ul> <li>Nesting GitopsSets within each other, as the default delimiters will conflict</li> <li>Providing unquoted values to yaml</li> </ul> <h3 id=unquoted-values>Unquoted values<a class=headerlink href=#unquoted-values title="Permanent link">¶</a></h3> <p>In yaml <code>{{</code> is invalid syntax and needs to be quoted. If you need to provide a un-quoted number value like <code>replicas: 3</code> you should use the <code>${{,}}</code> delimiters.</p> <ul> <li>❌ <code>replicas: {{ .params.REPLICAS }}</code> Invalid yaml</li> <li>❌ <code>replicas: "{{ .params.REPLICAS }}"</code> Valid yaml, incorrect type. The type is a string not a number and will fail validation.</li> <li>✅ <code>replicas: ${{ .params.REPLICAS }}</code> Valid yaml and correct number type.</li> </ul> <p>Unquoted values allow you to include objects in your templates too.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>templates.weave.works/delimiters</span><span class=p>:</span><span class=w> </span><span class=s>"${{,}}"</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>        </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=w>            </span><span class=nt>resources</span><span class=p>:</span>
<span class=w>              </span><span class=nt>limits</span><span class=p>:</span>
<span class=w>                </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<span class=w>                </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128Mi</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>            </span><span class=nt>resources</span><span class=p>:</span>
<span class=w>              </span><span class=nt>limits</span><span class=p>:</span>
<span class=w>                </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<span class=w>                </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128Mi</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>template</span><span class=p>:</span>
<span class=w>            </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>              </span><span class=nt>containers</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>                  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">weaveworks/go-demo:0.2.0</span>
<span class=w>                  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ .Element.resources | toJson }}</span>
</code></pre></div> <p>With the default <code>{{,}}</code> delimiters this would fail as the "resources" field would need to be quoted.</p> <p>Again, if we quote them we would get a string value, not an object.</p> <h2 id=generators>Generators<a class=headerlink href=#generators title="Permanent link">¶</a></h2> <p>We currently provide these generators: - <a href=#list-generator>list</a> - <a href=#pullrequests-generator>pullRequests</a> - <a href=#gitrepository-generator>gitRepository</a> - <a href=#ocirepository-generator>ociRepository</a> - <a href=#matrix-generator>matrix</a> - <a href=#apiclient-generator>apiClient</a> - <a href=#cluster-generator>cluster</a> - <a href=#imagepolicy-generator>imagepolicy</a> - <a href=#config-generator>config</a></p> <h3 id=list-generator>List generator<a class=headerlink href=#list-generator title="Permanent link">¶</a></h3> <p>This is the simplest generator, which is a hard-coded array of JSON objects, described as YAML mappings.</p> <h3 id=gitrepository-generator>GitRepository generator<a class=headerlink href=#gitrepository-generator title="Permanent link">¶</a></h3> <p>The <code>GitRepository</code> generator operates on <a href=https://fluxcd.io/flux/components/source/gitrepositories/ >Flux GitRepositories</a>.</p> <p>When a <code>GitRepository</code> is updated, this will trigger a regeneration of templates.</p> <p>The generator operates in two different ways, you can parse files (YAML or JSON) into Elements, or you can scan directories for subdirectories.</p> <h4 id=generation-from-files>Generation from files<a class=headerlink href=#generation-from-files title="Permanent link">¶</a></h4> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">repository-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>gitRepository</span><span class=p>:</span>
<span class=w>        </span><span class=nt>repositoryRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
<span class=w>        </span><span class=nt>files</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/dev.yaml</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/production.yaml</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/staging.yaml</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.team</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
</code></pre></div> <p>In this example, a <a href=https://fluxcd.io/flux/components/source/gitrepositories/ >Flux <code>GitRepository</code></a> called <code>go-demo-repo</code> in the same namespace as the <code>GitOpsSet</code> will be tracked, and <code>Kustomization</code> resources will be generated from the three files listed.</p> <p>These files can be JSON or YAML.</p> <p>In this example we expect to find the following structure in the files:</p> <div class=highlight><pre><span></span><code><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">developers</span>
</code></pre></div> <p>Changes pushed to the <code>GitRepository</code> will result in rereconciliation of the templates into the cluster.</p> <p>For security reasons, you need to explicitly list out the files that the generator should parse.</p> <h4 id=generation-from-directories>Generation from directories<a class=headerlink href=#generation-from-directories title="Permanent link">¶</a></h4> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/managed-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/created-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">repository-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>gitRepository</span><span class=p>:</span>
<span class=w>        </span><span class=nt>repositoryRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
<span class=w>        </span><span class=nt>directories</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/kustomize/environments/*</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.Base</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.Base</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.Base</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.Directory</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
</code></pre></div> <p>In this example, a <a href=https://fluxcd.io/flux/components/source/gitrepositories/ >Flux <code>GitRepository</code></a> called <code>go-demo-repo</code> in the same namespace as the <code>GitOpsSet</code> will be tracked, and <code>Kustomization</code> resources are generated from paths within the <code>examples/kustomize/environments/*</code> directory within the repository.</p> <p>Each generated element has two keys, <code>.Element.Directory</code> which will be a repo-relative path and <code>.Element.Base</code> which contains the last element of the path, for example, for a directory <code>./examples/kustomize/environments/production</code> this will be <code>production</code>.</p> <p>It is also possible to exclude paths from the generated list, for example, if you do not want to generate for a directory you can exclude it with:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">repository-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>gitRepository</span><span class=p>:</span>
<span class=w>        </span><span class=nt>repositoryRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
<span class=w>        </span><span class=nt>directories</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/kustomize/environments/*</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/kustomize/environments/production</span>
<span class=w>            </span><span class=nt>exclude</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
</code></pre></div> <p>In this case, all directories that are subdirectories of <code>examples/kustomize/environments</code> will be generated, <strong>but</strong> not <code>examples/kustomize/environments/production</code>.</p> <p><strong>Note</strong>: The directory tree detection is restricted to the same directory as the path, no recursion is done.</p> <p>In fact the path is treated as a <a href=https://pkg.go.dev/path/filepath#Glob>Glob</a>.</p> <h3 id=ocirepository-generator>OCIRepository generator<a class=headerlink href=#ocirepository-generator title="Permanent link">¶</a></h3> <p>The <code>OCIRepository</code> generator operates on <a href=https://fluxcd.io/flux/components/source/ocirepositories/ >Flux OCIRepositories</a>.</p> <p>When an <code>OCIRepository</code> is updated, this will trigger a regeneration of templates.</p> <p>The <code>OCIRepository</code> generator operates in exactly the same way as the <a href=#gitrepository-generator>GitRepository generator</a>, except it operates on OCIRepositories.</p> <h4 id=generation-from-files_1>Generation from files<a class=headerlink href=#generation-from-files_1 title="Permanent link">¶</a></h4> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oci-repository-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ociRepository</span><span class=p>:</span>
<span class=w>        </span><span class=nt>repositoryRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-oci-repo</span>
<span class=w>        </span><span class=nt>files</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/dev.yaml</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/production.yaml</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/staging.yaml</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.team</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
</code></pre></div> <h3 id=pullrequests-generator>PullRequests generator<a class=headerlink href=#pullrequests-generator title="Permanent link">¶</a></h3> <p>This will require to make authenticated requests to your Git hosting provider e.g. GitHub, GitLab, Bitbucket etc.</p> <p>It does only require read-only access, but all API tokens should be guarded as carefully as possible, what is a "read-only" token today, might become a token with higher-privilege in the future.</p> <p><em>There have been many security compromises using API access tokens, do not let this happen to you!</em></p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">pull-requests-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pullRequests</span><span class=p>:</span>
<span class=w>        </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>        </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github</span>
<span class=w>        </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bigkevmcd/go-demo</span>
<span class=w>        </span><span class=nt>secretRef</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github-secret</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">source.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"pr-{{</span><span class=nv> </span><span class=s>.Element.Number</span><span class=nv> </span><span class=s>}}-gitrepository"</span>
<span class=w>          </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m0s</span>
<span class=w>          </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.CloneURL</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>ref</span><span class=p>:</span>
<span class=w>            </span><span class=nt>branch</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.Branch</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"pr-{{</span><span class=nv> </span><span class=s>.Element.Number</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/dev"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>targetNamespace</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.Branch</span><span class=nv> </span><span class=s>}}-ns"</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"pr-{{</span><span class=nv> </span><span class=s>.Element.Number</span><span class=nv> </span><span class=s>}}-gitrepository"</span>
</code></pre></div> <p>This example will poll "github.com/bigkevmcd/go-demo" for open pull requests and trigger the deployment of these by creating a Flux <code>GitRepository</code> and a <code>Kustomization</code> to deploy.</p> <p>As the generator only queries open pull requests, when a PR is closed, the generated resources will be removed.</p> <p>For non-public installations, you can configure the <code>serverURL</code> field and point it to your own installation.</p> <p>The <code>driver</code> field can be <code>github</code> or <code>gitlab</code> or <code>bitbucketserver</code>, other options can be supported from <a href=https://github.com/jenkins-x/go-scm/blob/main/scm/factory/factory.go>go-scm</a>.</p> <p>The <code>forks</code> flag field can be used to indicate whether to include forks in the target pull requests or not. If set to <code>true</code> any pull request from a fork repository will be included, otherwise if <code>false</code> or not indicated the pull requests from fork repositories are discarded.</p> <p>Additionally labels can be provided for querying pull requests with matching labels e.g.</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>pullRequests</span><span class=p>:</span>
<span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github</span>
<span class=w>    </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bigkevmcd/go-demo</span>
<span class=w>    </span><span class=nt>secretRef</span><span class=p>:</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github-secret</span>
<span class=w>    </span><span class=nt>forks</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>    </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</code></pre></div> <p>The fields emitted by the pull-request are as follows:</p> <ul> <li><code>Number</code> this is generated as a string representation</li> <li><code>Branch</code> this is the source branch</li> <li><code>HeadSHA</code> this is the SHA of the commit in the merge branch</li> <li><code>CloneURL</code> this is the HTTPS clone URL for this repository</li> <li><code>CloneSSHURL</code> this is the SSH clone URL for this repository</li> <li><code>Fork</code> this indicates whether the pull request is from a fork (true) or not (false)</li> </ul> <p>Create a read-only token that can list Pull Requests, and store it in a secret:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>github-secret<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--from-literal<span class=w> </span><span class=nv>password</span><span class=o>=</span>&lt;insert<span class=w> </span>access<span class=w> </span>token<span class=w> </span>here&gt;
</code></pre></div> <h3 id=matrix-generator>Matrix generator<a class=headerlink href=#matrix-generator title="Permanent link">¶</a></h3> <p>The matrix generator doesn't generate resources by itself. It combines the results of generation from other generators e.g.:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">matrix-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matrix</span><span class=p>:</span>
<span class=w>        </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>gitRepository</span><span class=p>:</span>
<span class=w>              </span><span class=nt>repositoryRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
<span class=w>              </span><span class=nt>files</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/dev.yaml</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/production.yaml</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/staging.yaml</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>              </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</code></pre></div> <p>Given the files mentioned all have the following structure:</p> <div class=highlight><pre><span></span><code><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">developers</span>
</code></pre></div> <p>This will result in three sets of generated parameters, which are a combination of the maps in the files in the gitRepository, and the elements in the list generator, this can result in a combinatorial explosion of resources being created in your cluster.</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=w>  </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">developers</span>
<span class=w>  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>  </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-team</span>
<span class=w>  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>  </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production-team</span>
<span class=w>  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</code></pre></div> <p>These can be referenced in the templates, note that all keys in the merged generators from the Matrix are contained in the <code>Element</code> scope.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">matrix-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matrix</span><span class=p>:</span>
<span class=w>        </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>gitRepository</span><span class=p>:</span>
<span class=w>              </span><span class=nt>repositoryRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
<span class=w>              </span><span class=nt>files</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/dev.yaml</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/production.yaml</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/staging.yaml</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>              </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.team</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/cluster</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.cluster</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/version</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.version</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
</code></pre></div> <h4 id=optional-name-for-matrix-elements>Optional Name for Matrix elements<a class=headerlink href=#optional-name-for-matrix-elements title="Permanent link">¶</a></h4> <p>If you want to use two generators in a Matrix that output the same fields, they will collide, for example, the <code>ImagePolicy</code> generator outputs a <code>latestImage</code> field, if you have two, they will collide.</p> <p>You can provide a name for the generator in the Matrix:</p> <p><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">matrix-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matrix</span><span class=p>:</span>
<span class=w>        </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gen1</span>
<span class=w>            </span><span class=nt>gitRepository</span><span class=p>:</span>
<span class=w>              </span><span class=nt>repositoryRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
<span class=w>              </span><span class=nt>files</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/dev.yaml</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/production.yaml</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">examples/generation/staging.yaml</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gen2</span>
<span class=w>            </span><span class=nt>list</span><span class=p>:</span>
<span class=w>              </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.gen1.env</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.gen1.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.gen1.team</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/cluster</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.gen2.cluster</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/version</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.gen2.version</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/{{</span><span class=nv> </span><span class=s>.Element.gen1.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
</code></pre></div> The name value is used as a key in the generated results.</p> <p>The example above will yield:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>gen1</span><span class=p>:</span>
<span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=w>    </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">developers</span>
<span class=w>  </span><span class=nt>gen2</span><span class=p>:</span>
<span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>    </span><span class=nt>ersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>gen1</span><span class=p>:</span>
<span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>    </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-team</span>
<span class=w>  </span><span class=nt>gen2</span><span class=p>:</span>
<span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>gen1</span><span class=p>:</span>
<span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>    </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production-team</span>
<span class=w>  </span><span class=nt>gen2</span><span class=p>:</span>
<span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</code></pre></div> <h4 id=single-element-for-matrix>Single Element for Matrix<a class=headerlink href=#single-element-for-matrix title="Permanent link">¶</a></h4> <p>A matrix generator will normally generate a cartesian result, but you can also generate a single result.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">single-element-matrix-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matrix</span><span class=p>:</span>
<span class=w>        </span><span class=nt>singleElement</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>        </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>          </span><span class=nt>cluster</span><span class=p>:</span>
<span class=w>            </span><span class=nt>selector</span><span class=p>:</span>
<span class=w>              </span><span class=nt>matchLabels</span><span class=p>:</span>
<span class=w>                </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>          </span><span class=nt>cluster</span><span class=p>:</span>
<span class=w>            </span><span class=nt>selector</span><span class=p>:</span>
<span class=w>              </span><span class=nt>matchLabels</span><span class=p>:</span>
<span class=w>                </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</code></pre></div> <p>This would query for clusters matching the respective labels.</p> <p>The resulting output would look like this (in YAML):</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>production</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production-cluster1</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production-cluster2</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class=w>  </span><span class=nt>staging</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-cluster1</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-cluster2</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
</code></pre></div> <p>Compare this with the alternative without the <code>singleElement</code> flag:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>production</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production-cluster1</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class=w>  </span><span class=nt>staging</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-cluster1</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>production</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production-cluster2</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class=w>  </span><span class=nt>staging</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-cluster1</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>production</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production-cluster1</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class=w>  </span><span class=nt>staging</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-cluster2</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>production</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production-cluster2</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
<span class=w>  </span><span class=nt>staging</span><span class=p>:</span>
<span class=w>    </span><span class=nt>ClusterAnnotations</span><span class=p>:</span><span class=w> </span><span class=c1># omitted</span>
<span class=w>    </span><span class=nt>ClusterLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>    </span><span class=nt>ClusterName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging-cluster2</span>
<span class=w>    </span><span class=nt>ClusterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clusters</span>
</code></pre></div> <p>In the <code>singleElement</code> case, there is only one generated element, only one template will be rendered for each content item.</p> <p>If the Matrix generators are unnamed, they will be grouped under a top-level <code>.Matrix</code> name.</p> <h3 id=apiclient-generator>apiClient generator<a class=headerlink href=#apiclient-generator title="Permanent link">¶</a></h3> <p>This generator is configured to poll an HTTP endpoint and parse the result as the generated values.</p> <p>This will poll an endpoint on the interval, instead of using the simpler to use PullRequest generator, you can access GitHub's API with the APIClient generator.</p> <p>The PullRequest generator is simpler to use, and works across multiple different git-providers.</p> <p>The GitHub <a href="https://docs.github.com/en/rest/pulls/pulls?apiVersion=2022-11-28#list-pull-requests">documentation</a> for the API endpoint shows:</p> <div class=highlight><pre><span></span><code>curl<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-H<span class=w> </span><span class=s2>"Accept: application/vnd.github+json"</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>-H<span class=w> </span><span class=s2>"Authorization: Bearer &lt;YOUR-TOKEN&gt;"</span><span class=se>\</span>
<span class=w>  </span>-H<span class=w> </span><span class=s2>"X-GitHub-Api-Version: 2022-11-28"</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>https://api.github.com/repos/OWNER/REPO/pulls
</code></pre></div> <p>This can be translated into...</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/managed-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/created-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api-client-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiClient</span><span class=p>:</span>
<span class=w>        </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://api.github.com/repos/bigkevmcd/go-demo/pulls</span>
<span class=w>        </span><span class=nt>headersRef</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github-secret</span>
<span class=w>          </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">source.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"pr-{{</span><span class=nv> </span><span class=s>.Element.id</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>toJson}}-gitrepository"</span>
<span class=w>          </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m0s</span>
<span class=w>          </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.head.repo.clone_url</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>ref</span><span class=p>:</span>
<span class=w>            </span><span class=nt>branch</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.head.ref</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"pr-{{</span><span class=nv> </span><span class=s>.Element.id</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>toJson</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/dev"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>targetNamespace</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.head.ref</span><span class=nv> </span><span class=s>}}-ns"</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"pr-{{</span><span class=nv> </span><span class=s>.Element.id</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>toJson</span><span class=nv> </span><span class=s>}}-gitrepository"</span>
</code></pre></div> <p>As with the <a href=#pullrequests-generator>Pull Request generator</a>, this also requires a secret token to be able to access the API</p> <p>We need to pass this as an HTTP header.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github-secret</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class=nt>stringData</span><span class=p>:</span>
<span class=w>  </span><span class=nt>Accept</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">application/vnd.github+json</span>
<span class=w>  </span><span class=nt>Authorization</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Bearer ghp_&lt;redacted&gt;</span>
<span class=w>  </span><span class=nt>X-GitHub-Api-Version</span><span class=p>:</span><span class=w> </span><span class=s>"2022-11-28"</span>
</code></pre></div> <p>The keys in the secret match the command-line example using curl.</p> <p>Unlike the Pull Request generator, you need to figure out the paths to the elements yourself.</p> <h4 id=apiclient-jsonpath>APIClient JSONPath<a class=headerlink href=#apiclient-jsonpath title="Permanent link">¶</a></h4> <p>Not all APIs return an array of JSON objects, sometimes it's nested within a result type structure e.g.</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>"things"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>"env"</span><span class=p>:</span><span class=w> </span><span class=s2>"dev"</span><span class=p>,</span>
<span class=w>      </span><span class=nt>"team"</span><span class=p>:</span><span class=w> </span><span class=s2>"dev-team"</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>"env"</span><span class=p>:</span><span class=w> </span><span class=s2>"production"</span><span class=p>,</span>
<span class=w>      </span><span class=nt>"team"</span><span class=p>:</span><span class=w> </span><span class=s2>"opts-team"</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>"env"</span><span class=p>:</span><span class=w> </span><span class=s2>"staging"</span><span class=p>,</span>
<span class=w>      </span><span class=nt>"team"</span><span class=p>:</span><span class=w> </span><span class=s2>"opts-team"</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p>You can use JSONPath to extract the fields from this data...</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/managed-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/created-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api-client-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiClient</span><span class=p>:</span>
<span class=w>        </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com/demo</span>
<span class=w>        </span><span class=nt>jsonPath</span><span class=p>:</span><span class=w> </span><span class=s>"{</span><span class=nv> </span><span class=s>$.things</span><span class=nv> </span><span class=s>}"</span>
</code></pre></div> <p>This will generate three maps for templates, with just the <em>env</em> and <em>team</em> keys.</p> <h4 id=apiclient-post-body>APIClient POST body<a class=headerlink href=#apiclient-post-body title="Permanent link">¶</a></h4> <p>Another piece of functionality in the APIClient generator is the ability to POST JSON to the API.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/managed-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/created-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api-client-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiClient</span><span class=p>:</span>
<span class=w>        </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com/demo</span>
<span class=w>        </span><span class=nt>body</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"testing"</span>
<span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>"testing2"</span>
</code></pre></div> <p>This will send a request body as JSON (Content-Type "application/json") to the server and interpret the result.</p> <p>The JSON body sent will look like this:</p> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=w> </span><span class=nt>"name"</span><span class=p>:</span><span class=w> </span><span class=s2>"testing"</span><span class=p>,</span><span class=w> </span><span class=nt>"value"</span><span class=p>:</span><span class=w> </span><span class=s2>"testing2"</span><span class=w> </span><span class=p>}</span>
</code></pre></div> <h4 id=apiclient-simple-results>APIClient simple results<a class=headerlink href=#apiclient-simple-results title="Permanent link">¶</a></h4> <p>Instead of using the JSONPath to extract from a complex structure, you can configure the result to be a single element.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/created-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api-client-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiClient</span><span class=p>:</span>
<span class=w>        </span><span class=nt>singleElement</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>        </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com/demo</span>
</code></pre></div> <p>Whatever result is parsed from the API endpoint will be returned as a map in a single element.</p> <p>For generation, you might need to use the <code>repeat</code> mechanism to generate repeating results.</p> <h4 id=apiclient-custom-ca>APIClient Custom CA<a class=headerlink href=#apiclient-custom-ca title="Permanent link">¶</a></h4> <p>If the API endpoint you are accessing requires a custom CA you can provide this via the secret field.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopsset-sample</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>    </span><span class=nt>app.kubernetes.io/created-by</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitopssets-controller</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api-client-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiClient</span><span class=p>:</span>
<span class=w>        </span><span class=nt>singleElement</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>        </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com/demo</span>
<span class=w>        </span><span class=nt>secretRef</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https-ca-credentials</span>
</code></pre></div> <p>This secret should look like this:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https-ca-credentials</span>
<span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class=nt>caFile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;BASE64&gt;</span>
</code></pre></div> <p>The request will be made with the custom CA.</p> <h3 id=cluster-generator>Cluster generator<a class=headerlink href=#cluster-generator title="Permanent link">¶</a></h3> <p>The cluster generator generates from in-cluster GitOpsCluster resources.</p> <p>For example, this <code>GitOpsSet</code> will generate a <code>Kustomization</code> resource for each cluster matching the <a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/ >Label selector</a>.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cluster-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span>
<span class=w>        </span><span class=nt>selector</span><span class=p>:</span>
<span class=w>          </span><span class=nt>matchLabels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-team</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.ClusterName</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.ClusterName</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.ClusterLabels.team</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/{{</span><span class=nv> </span><span class=s>.Element.ClusterLabels.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
</code></pre></div> <p>The following fields are generated for each GitOpsCluster.</p> <ul> <li><code>ClusterName</code> the name of the cluster</li> <li><code>ClusterNamespace</code> the namespace that this cluster is from</li> <li><code>ClusterLabels</code> the labels from the metadata field on the GitOpsCluster</li> <li><code>ClusterAnnotations</code> the annotations from the metadata field on the GitOpsCluster</li> </ul> <p>If the selector is not provided, all clusters from all namespaces will be returned:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cluster-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
</code></pre></div> <p>Otherwise if the selector is empty, no clusters will be generated:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cluster-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span>
<span class=w>        </span><span class=nt>selector</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
</code></pre></div> <h3 id=imagepolicy-generator>ImagePolicy generator<a class=headerlink href=#imagepolicy-generator title="Permanent link">¶</a></h3> <p>The <code>ImagePolicy</code> generator works with the <a href=https://fluxcd.io/flux/components/image/ >Flux Image Automation</a>.</p> <p>When an <code>ImagePolicy</code> is updated, this will trigger a regeneration of templates.</p> <p>The generated elements have the following fields:</p> <ul> <li>latestImage - the latest image from the status field on the <code>ImagePolicy</code></li> <li>latestTag - only the tag part of the latestImage, e.g. will be v0.1 for an image of "testing/image:v0.1"</li> <li>previousImage - the previous image from the status field on the <code>ImagePolicy</code></li> </ul> <p>This can be used simply, to create a deployment with an image...or, combined with a Matrix generator, to manage multiple workloads with the same image.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">imagepolicy-example</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>imagePolicy</span><span class=p>:</span>
<span class=w>        </span><span class=nt>policyRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">podinfo</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"demo-configmap"</span>
<span class=w>        </span><span class=nt>data</span><span class=p>:</span>
<span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.latestImage</span><span class=nv> </span><span class=s>}}"</span>
</code></pre></div> <p>In this example, a <code>ConfigMap</code> is generated containing the latest image whenever an <code>ImagePolicy</code> called <code>podinfo</code> is updated.</p> <p>Combined in a Matrix, like this, it will generate two <code>ConfigMaps</code> with the values.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">imagepolicy-matrix-example</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matrix</span><span class=p>:</span>
<span class=w>        </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>imagePolicy</span><span class=p>:</span>
<span class=w>             </span><span class=nt>policyRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">podinfo</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>              </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prod-cluster</span>
<span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"demo-configmap-{{</span><span class=nv> </span><span class=s>.Element.cluster</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>data</span><span class=p>:</span>
<span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.latestImage</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.cluster</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.version</span><span class=nv> </span><span class=s>}}"</span>
</code></pre></div> <p>The resulting ConfigMaps look like this:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>configmaps
NAME<span class=w>                          </span>DATA<span class=w>   </span>AGE
demo-configmap-dev-cluster<span class=w>    </span><span class=m>3</span><span class=w>      </span>3m19s
demo-configmap-prod-cluster<span class=w>   </span><span class=m>3</span><span class=w>      </span>3m19s
</code></pre></div> <p>With the templated fields like this:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">demo-configmap-dev-cluster</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stefanprodan/podinfo:5.1.4</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">demo-configmap-prod-cluster</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prod-cluster</span>
<span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stefanprodan/podinfo:5.1.4</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</code></pre></div> <h3 id=config-generator>Config generator<a class=headerlink href=#config-generator title="Permanent link">¶</a></h3> <p>The <code>Config</code> generator with Kubernetes <a href=https://kubernetes.io/docs/concepts/configuration/configmap/ >ConfigMaps</a> and <a href=https://kubernetes.io/docs/concepts/configuration/secret/ >Secrets</a>.</p> <p>When an <code>ConfigMap</code> or <code>Secret</code> is updated, this will trigger a regeneration of templates.</p> <p>This can be used simply, to create a resource with an config variable...or, combined with a Matrix generator, to manage multiple workloads with the same values.</p> <p>With the existing <code>ConfigMap</code> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-cm</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-config</span>
<span class=w>  </span><span class=nt>demo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-value</span>
</code></pre></div> And the GitOpsSet below <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>config</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-cm</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.name</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.name</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>data</span><span class=p>:</span>
<span class=w>          </span><span class=nt>generatedValue</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.demo</span><span class=nv> </span><span class=s>}}"</span>
</code></pre></div> In this example, a new <code>ConfigMap</code> is generated containing the value of the "demo" field from the existing <code>ConfigMap</code> <em>test-cm</em>.</p> <p>As with the other generators, the <code>Config</code> generator can be combined with other generators:</p> <p>This will generate two <code>ConfigMaps</code> with the values. <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">imagepolicy-matrix-example</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matrix</span><span class=p>:</span>
<span class=w>        </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>config</span><span class=p>:</span>
<span class=w>              </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-cm</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>              </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class=w>                </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prod-cluster</span>
<span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"demo-configmap-{{</span><span class=nv> </span><span class=s>.Element.cluster</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>data</span><span class=p>:</span>
<span class=w>          </span><span class=nt>generatedValue</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.demo</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.cluster</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.version</span><span class=nv> </span><span class=s>}}"</span>
</code></pre></div></p> <p>The resulting ConfigMaps look like this:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>configmaps
NAME<span class=w>                          </span>DATA<span class=w>   </span>AGE
demo-configmap-dev-cluster<span class=w>    </span><span class=m>3</span><span class=w>      </span>3m19s
demo-configmap-prod-cluster<span class=w>   </span><span class=m>3</span><span class=w>      </span>3m19s
</code></pre></div> <p>With the templated fields like this:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">demo-configmap-dev-cluster</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-cluster</span>
<span class=w>  </span><span class=nt>generatedValue</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-value</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">demo-configmap-prod-cluster</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prod-cluster</span>
<span class=w>  </span><span class=nt>generatedValue</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-value</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</code></pre></div> <h2 id=templating-functions>Templating functions<a class=headerlink href=#templating-functions title="Permanent link">¶</a></h2> <p>Currently, the <a href=http://masterminds.github.io/sprig/ >Sprig</a> functions are available in the templating, with some functions removed[^sprig] for security reasons.</p> <p>In addition, we also provide two additional functions:</p> <ul> <li>sanitize - sanitises strings to be compatible with <a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names>Kubernetes DNS</a> name requirements</li> <li>getordefault - gets a key from the <code>.Element</code> or defaults to another value.</li> </ul> <p>The examples below assume an element that looks like this:</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>"team"</span><span class=p>:</span><span class=w> </span><span class=s2>"engineering dev"</span>
<span class=p>}</span>
</code></pre></div> <h3 id=sanitize-template-function>sanitize template function<a class=headerlink href=#sanitize-template-function title="Permanent link">¶</a></h3> <p>And a template that looks like this:</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{{</span><span class=w> </span><span class=nv>sanitize .Element.team</span><span class=w> </span><span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-demo</span>
</code></pre></div> <p>This would output:</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">engineeringdev-demo</span>
</code></pre></div> <h3 id=getordefault>getordefault<a class=headerlink href=#getordefault title="Permanent link">¶</a></h3> <p>For template that looks like this:</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{{</span><span class=w> </span><span class=nv>getordefault .Element "name" "defaulted"</span><span class=w> </span><span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-demo</span>
</code></pre></div> <p>This would output:</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">defaulted-demo</span>
</code></pre></div> <p>If the <em>key</em> to get does exist in the <code>.Element</code> it will be inserted, the "default" is only inserted if it doesn't exist.</p> <h2 id=security>Security<a class=headerlink href=#security title="Permanent link">¶</a></h2> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Generating resources and applying them directly into your cluster can be dangerous to the health of your cluster.</p> </div> <p>This is especially true for the <code>GitRepository</code> generator, where it may not be obvious to the author of the files, or the author of the template the consequences of the template rendering.</p> <p>The default <code>ServiceAccount</code> that is used by the gitopssets-controller is extremely limited, and can not create resources, you will need to explicitly grant permissions to create any of the resources you declare in the template, missing permissions will appear in the controller logs.</p> <p>It is not recommended that you create a role with blanket permissions, under the right circumstances, someone could accidentally <em>or</em> maliciously overwrite the cluster control-plane, which could be very dangerous.</p> <h2 id=limiting-via-service-accounts>Limiting via service-accounts<a class=headerlink href=#limiting-via-service-accounts title="Permanent link">¶</a></h2> <p>You can configure the service-account that is used to create resources.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">templates.weave.works/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitOpsSet</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">matrix-sample</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=c1># the controller will impersonate this service account</span>
<span class=w>  </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test-sa</span>
<span class=w>  </span><span class=nt>generators</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>list</span><span class=p>:</span>
<span class=w>        </span><span class=nt>elements</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev-team</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ops-team</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=w>            </span><span class=nt>team</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ops-team</span>
<span class=w>  </span><span class=nt>templates</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>content</span><span class=p>:</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io/v1beta2</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}-demo"</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo</span>
<span class=w>            </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>            </span><span class=nt>com.example/team</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>.Element.team</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>          </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>"./examples/kustomize/environments/{{</span><span class=nv> </span><span class=s>.Element.env</span><span class=nv> </span><span class=s>}}"</span>
<span class=w>          </span><span class=nt>prune</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>          </span><span class=nt>sourceRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GitRepository</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">go-demo-repo</span>
</code></pre></div> <h2 id=gitopsset-controller-configuration>gitopsset-controller configuration<a class=headerlink href=#gitopsset-controller-configuration title="Permanent link">¶</a></h2> <p>The enabled generators can be configured via the <code>--enabled-generators</code> flag, which takes a comma separated list of generators to enable.</p> <p>The default is to enable all generators.</p> <p>For example to enable only the <code>List</code> and <code>GitRepository</code> generators:</p> <div class=highlight><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">--enabled-generators=List,GitRepository</span>
</code></pre></div> <p>When a GitOpsSet that uses disabled generators is created, the disabled generators will be silently ignored.</p> <h2 id=kubernetes-process-limits>Kubernetes Process Limits<a class=headerlink href=#kubernetes-process-limits title="Permanent link">¶</a></h2> <p>GitOpsSets can be memory-hungry, for example, the Matrix generator will generate a cartesian result with multiple copies of data.</p> <p>The OCI and GitRepository generators will extract tarballs, the API Generator queries upstream APIs and parses the JSON, and the Config generators will load <code>Secret</code> and <code>ConfigMap</code> resources, all these can lead to using significant amounts of memory.</p> <p>Extracting tarballs can also prove to be CPU intensive, especially where there are lots of files, and you have a very frequent regeneration period.</p> <p>To this end, you will need to monitor the controller metrics, and maybe increase the limits available to the controller.</p> <p>For example, to increase the amount of memory available to the controller:</p> <div class=highlight><pre><span></span><code><span class=nt>resources</span><span class=p>:</span>
<span class=w>  </span><span class=nt>limits</span><span class=p>:</span>
<span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1000m</span>
<span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2Gi</span>
<span class=w>  </span><span class=nt>requests</span><span class=p>:</span>
<span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">64Mi</span>
</code></pre></div> <h2 id=notifications>Notifications<a class=headerlink href=#notifications title="Permanent link">¶</a></h2> <p>Events are enabled which will trigger Kubernetes events when successful reconciliation occurs with a <code>Normal</code> event or when reconciliation fails with an <code>Error</code> event. Fluxcd's <a href=https://pkg.go.dev/github.com/fluxcd/pkg/runtime/events>Events</a> package is used including the <code>EventRecorder</code> to record these events.</p> <p>To configure receiving the recorded events on a specific host, this can be provided via the <code>--events-addr</code> flag in <code>RUN_ARGS</code> when starting the controller. This can be any HTTP endpoint.</p> <p>See <a href=https://github.com/fluxcd/pkg/blob/main/apis/event/v1beta1/event.go>fluxcd event</a> for the struct of the event created.</p> <p>[^yaml]: These are written as YAML mappings [^sprig]: The following functions are removed "env", "expandenv", "getHostByName", "genPrivateKey", "derivePassword", "sha256sum", "base", "dir", "ext", "clean", "isAbs", "osBase", "osDir", "osExt", "osClean", "osIsAbs"</p> <form class=md-feedback hidden name=feedback> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" data-md-value=1 title="This page was helpful" type=submit> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M5 9v12H1V9h4m4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21H9m0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03V19Z"></path></svg> </button> <button class="md-feedback__icon md-icon" data-md-value=0 title="This page could be improved" type=submit> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 15V3h4v12h-4M15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3h9m0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97V5Z"></path></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/eksctl-io/eksctl/issues/new/?title=[Feedback]+Templating%20from%20Generators+-+/gitopssets/templating-from-generators/" rel=noopener target=_blank>feedback form <a>. </a></a></div> </div> </div> </fieldset> </form> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <a class="md-top md-icon" data-md-component=top hidden href=#> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </a> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: Installation" class="md-footer__link md-footer__link--prev" href=../gitopssets-installation/ rel=prev> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Installation </div> </div> </a> <a aria-label="Next: API reference" class="md-footer__link md-footer__link--next" href=../gitopssets-api-reference/ rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> API reference </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <p>Site powered by <a href=https://netlify.com>Netlify ©</a></p> <p>Copyright © 2023 Weaveworks <br> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </p> </div> <div class=md-social> <a class=md-social__link href=https://www.facebook.com/WeaveworksInc/ rel=noopener target=_blank title=www.facebook.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg> </a> <a class=md-social__link href=https://www.linkedin.com/company/weaveworks rel=noopener target=_blank title=www.linkedin.com> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg> </a> <a class=md-social__link href=https://twitter.com/weaveworks rel=noopener target=_blank title=twitter.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> </a> <a class=md-social__link href=https://slack.weave.works/ rel=noopener target=_blank title=slack.weave.works> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"></path></svg> </a> <a class=md-social__link href=https://www.youtube.com/c/WeaveWorksInc rel=noopener target=_blank title=www.youtube.com> <svg viewbox="0 0 576 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent hidden id=__consent> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle id=__settings type=checkbox> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input checked name=analytics type=checkbox> <span class=task-list-indicator></span> Google Analytics <label> </label></label></li> <li class=task-list-item> <label class=task-list-control> <input checked name=github type=checkbox> <span class=task-list-indicator></span> GitHub <label> </label></label></li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "search.highlight", "search.share", "search.suggest", "content.code.annotate", "content.tooltips", "content.tabs.link", "content.code.copy"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> <script src=../../javascripts/extra.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>